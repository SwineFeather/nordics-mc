import{I as X,s as f,r as o,i as je,j as e,w as N,x as P,y as A,b7 as Q,z as k,aI as Z,v as b,B as S,b5 as $,bT as J,bU as z,bd as B,be as O,bC as L,c0 as ve,bF as te,c1 as ye,c2 as ae,aG as we,b8 as se,c3 as Ne,c4 as be,X as V,c5 as ie,H as _e,aA as ne,G as re,a4 as Se,Q as ke,c6 as Te,c7 as le,c8 as Ce,O as U,M as Pe,aF as I,aX as ue,br as Ae,bN as Ee,ay as Me,c9 as ce,az as Ie,U as Fe,b1 as oe,Z as De,$ as We,a0 as $e,a1 as Ue,a2 as Y}from"./index-DUDTAd9W.js";import{u as xe}from"./use-toast-B0dFMpiE.js";import{R}from"./refresh-cw-DXtGU-vZ.js";import{T as G}from"./trophy-BsUhTMZd.js";import{L as K}from"./loader-circle-DMK_EDKw.js";import{C as ge}from"./circle-x-Djds9-Pf.js";import{S as ee}from"./separator-BkI5HRhN.js";import{T as Re}from"./trending-up-obebY5n1.js";import{B as Le}from"./building-D338Q9pK.js";import{H as ze}from"./house-DXLJ0JvH.js";import{S as Be}from"./switch-cn-L-SuC.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Oe=X("Castle",[["path",{d:"M22 20v-9H2v9a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2Z",key:"109fe4"}],["path",{d:"M18 11V4H6v7",key:"mon5oj"}],["path",{d:"M15 22v-4a3 3 0 0 0-3-3a3 3 0 0 0-3 3v4",key:"1k4jtn"}],["path",{d:"M22 11V9",key:"3zbp94"}],["path",{d:"M2 11V9",key:"1x5rnq"}],["path",{d:"M6 4V2",key:"1rsq15"}],["path",{d:"M18 4V2",key:"1jsdo1"}],["path",{d:"M10 4V2",key:"75d9ly"}],["path",{d:"M14 4V2",key:"8nj3z6"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ke=X("HardDrive",[["line",{x1:"22",x2:"2",y1:"12",y2:"12",key:"1y58io"}],["path",{d:"M5.45 5.11 2 12v6a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2v-6l-3.45-6.89A2 2 0 0 0 16.76 4H7.24a2 2 0 0 0-1.79 1.11z",key:"oot6mr"}],["line",{x1:"6",x2:"6.01",y1:"16",y2:"16",key:"sgf278"}],["line",{x1:"10",x2:"10.01",y1:"16",y2:"16",key:"1l4acy"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const qe=X("Play",[["polygon",{points:"6 3 20 12 6 21 6 3",key:"1oa8hb"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ve=X("TestTube",[["path",{d:"M14.5 2v17.5c0 1.4-1.1 2.5-2.5 2.5c-1.4 0-2.5-1.1-2.5-2.5V2",key:"125lnx"}],["path",{d:"M8.5 2h7",key:"csnxdl"}],["path",{d:"M14.5 16h-5",key:"1ox875"}]]),Ze=async()=>{const r=[{id:"playtime",name:"Time Lord",description:"Accumulate playtime on the server",stat:"custom_minecraft_play_time"},{id:"blocks_placed",name:"Master Builder",description:"Place blocks to build amazing structures",stat:"blocksPlaced"},{id:"blocks_broken",name:"Mining Master",description:"Break blocks to gather resources",stat:"blocksBroken"},{id:"mob_kills",name:"Combat Expert",description:"Defeat hostile mobs",stat:"mobKills"},{id:"diamond_mining",name:"Diamond Hunter",description:"Mine diamond ores",stat:"mined_minecraft_diamond_ore"},{id:"fishing",name:"Master Angler",description:"Catch fish and treasures",stat:"fishing_rod"},{id:"woodcutting",name:"Lumberjack",description:"Cut down trees and gather wood",stat:"mined_minecraft_oak_log"},{id:"travel",name:"Explorer",description:"Travel across the world",stat:"walk"},{id:"combat_weapons",name:"Weapon Master",description:"Master different combat weapons",stat:"netherite_sword"},{id:"ranged_combat",name:"Archer",description:"Master ranged combat",stat:"bow"}];for(const s of r){const{error:t}=await f.from("achievement_definitions").upsert(s,{onConflict:"id"});t&&console.error(`Error upserting achievement ${s.id}:`,t)}},He=async()=>{const r=[{achievement_id:"playtime",tier:1,name:"Newcomer",description:"Play for 1 hour",threshold:1,icon:"clock",points:50},{achievement_id:"playtime",tier:2,name:"Regular",description:"Play for 10 hours",threshold:10,icon:"clock",points:100},{achievement_id:"playtime",tier:3,name:"Dedicated",description:"Play for 50 hours",threshold:50,icon:"clock",points:150},{achievement_id:"playtime",tier:4,name:"Veteran",description:"Play for 100 hours",threshold:100,icon:"clock",points:200},{achievement_id:"playtime",tier:5,name:"Time Lord",description:"Play for 500 hours",threshold:500,icon:"clock",points:250},{achievement_id:"blocks_placed",tier:1,name:"Builder",description:"Place 1,000 blocks",threshold:1e3,icon:"hammer",points:50},{achievement_id:"blocks_placed",tier:2,name:"Constructor",description:"Place 5,000 blocks",threshold:5e3,icon:"hammer",points:100},{achievement_id:"blocks_placed",tier:3,name:"Engineer",description:"Place 25,000 blocks",threshold:25e3,icon:"hammer",points:150},{achievement_id:"blocks_placed",tier:4,name:"Master Builder",description:"Place 100,000 blocks",threshold:1e5,icon:"hammer",points:200},{achievement_id:"blocks_placed",tier:5,name:"Architect",description:"Place 500,000 blocks",threshold:5e5,icon:"hammer",points:250},{achievement_id:"blocks_broken",tier:1,name:"Miner",description:"Break 1,000 blocks",threshold:1e3,icon:"pickaxe",points:50},{achievement_id:"blocks_broken",tier:2,name:"Excavator",description:"Break 5,000 blocks",threshold:5e3,icon:"pickaxe",points:100},{achievement_id:"blocks_broken",tier:3,name:"Tunneler",description:"Break 25,000 blocks",threshold:25e3,icon:"pickaxe",points:150},{achievement_id:"blocks_broken",tier:4,name:"Mining Master",description:"Break 100,000 blocks",threshold:1e5,icon:"pickaxe",points:200},{achievement_id:"blocks_broken",tier:5,name:"Terraformer",description:"Break 500,000 blocks",threshold:5e5,icon:"pickaxe",points:250},{achievement_id:"mob_kills",tier:1,name:"Fighter",description:"Kill 100 mobs",threshold:100,icon:"swords",points:50},{achievement_id:"mob_kills",tier:2,name:"Warrior",description:"Kill 500 mobs",threshold:500,icon:"swords",points:100},{achievement_id:"mob_kills",tier:3,name:"Slayer",description:"Kill 2,500 mobs",threshold:2500,icon:"swords",points:150},{achievement_id:"mob_kills",tier:4,name:"Combat Expert",description:"Kill 10,000 mobs",threshold:1e4,icon:"swords",points:200},{achievement_id:"mob_kills",tier:5,name:"Legendary Hunter",description:"Kill 50,000 mobs",threshold:5e4,icon:"swords",points:250},{achievement_id:"diamond_mining",tier:1,name:"Prospector",description:"Mine 10 diamond ores",threshold:10,icon:"gem",points:100},{achievement_id:"diamond_mining",tier:2,name:"Diamond Hunter",description:"Mine 50 diamond ores",threshold:50,icon:"gem",points:200},{achievement_id:"diamond_mining",tier:3,name:"Diamond Master",description:"Mine 200 diamond ores",threshold:200,icon:"gem",points:300},{achievement_id:"diamond_mining",tier:4,name:"Diamond Baron",description:"Mine 1,000 diamond ores",threshold:1e3,icon:"gem",points:400},{achievement_id:"diamond_mining",tier:5,name:"Diamond King",description:"Mine 5,000 diamond ores",threshold:5e3,icon:"gem",points:500},{achievement_id:"fishing",tier:1,name:"Fisher",description:"Use fishing rod 100 times",threshold:100,icon:"ship",points:50},{achievement_id:"fishing",tier:2,name:"Angler",description:"Use fishing rod 500 times",threshold:500,icon:"ship",points:100},{achievement_id:"fishing",tier:3,name:"Master Angler",description:"Use fishing rod 2,500 times",threshold:2500,icon:"ship",points:150},{achievement_id:"fishing",tier:4,name:"Fishing Legend",description:"Use fishing rod 10,000 times",threshold:1e4,icon:"ship",points:200},{achievement_id:"fishing",tier:5,name:"Sea Lord",description:"Use fishing rod 50,000 times",threshold:5e4,icon:"ship",points:250},{achievement_id:"woodcutting",tier:1,name:"Woodcutter",description:"Mine 100 oak logs",threshold:100,icon:"tree-deciduous",points:50},{achievement_id:"woodcutting",tier:2,name:"Lumberjack",description:"Mine 500 oak logs",threshold:500,icon:"tree-deciduous",points:100},{achievement_id:"woodcutting",tier:3,name:"Forest Master",description:"Mine 2,500 oak logs",threshold:2500,icon:"tree-deciduous",points:150},{achievement_id:"woodcutting",tier:4,name:"Timber Baron",description:"Mine 10,000 oak logs",threshold:1e4,icon:"tree-deciduous",points:200},{achievement_id:"woodcutting",tier:5,name:"Nature Guardian",description:"Mine 50,000 oak logs",threshold:5e4,icon:"tree-deciduous",points:250},{achievement_id:"travel",tier:1,name:"Wanderer",description:"Walk 10,000 blocks",threshold:1e4,icon:"footprints",points:50},{achievement_id:"travel",tier:2,name:"Explorer",description:"Walk 50,000 blocks",threshold:5e4,icon:"footprints",points:100},{achievement_id:"travel",tier:3,name:"Adventurer",description:"Walk 250,000 blocks",threshold:25e4,icon:"footprints",points:150},{achievement_id:"travel",tier:4,name:"Voyager",description:"Walk 1,000,000 blocks",threshold:1e6,icon:"footprints",points:200},{achievement_id:"travel",tier:5,name:"World Walker",description:"Walk 5,000,000 blocks",threshold:5e6,icon:"footprints",points:250},{achievement_id:"combat_weapons",tier:1,name:"Swordsman",description:"Use netherite sword 100 times",threshold:100,icon:"sword",points:100},{achievement_id:"combat_weapons",tier:2,name:"Blade Master",description:"Use netherite sword 500 times",threshold:500,icon:"sword",points:200},{achievement_id:"combat_weapons",tier:3,name:"Weapon Master",description:"Use netherite sword 2,500 times",threshold:2500,icon:"sword",points:300},{achievement_id:"combat_weapons",tier:4,name:"Combat Legend",description:"Use netherite sword 10,000 times",threshold:1e4,icon:"sword",points:400},{achievement_id:"combat_weapons",tier:5,name:"War God",description:"Use netherite sword 50,000 times",threshold:5e4,icon:"sword",points:500},{achievement_id:"ranged_combat",tier:1,name:"Archer",description:"Use bow 100 times",threshold:100,icon:"bow",points:50},{achievement_id:"ranged_combat",tier:2,name:"Marksman",description:"Use bow 500 times",threshold:500,icon:"bow",points:100},{achievement_id:"ranged_combat",tier:3,name:"Sharpshooter",description:"Use bow 2,500 times",threshold:2500,icon:"bow",points:150},{achievement_id:"ranged_combat",tier:4,name:"Ranged Master",description:"Use bow 10,000 times",threshold:1e4,icon:"bow",points:200},{achievement_id:"ranged_combat",tier:5,name:"Eagle Eye",description:"Use bow 50,000 times",threshold:5e4,icon:"bow",points:250}];for(const s of r){const{error:t}=await f.from("achievement_tiers").upsert(s,{onConflict:"achievement_id,tier"});t&&console.error(`Error upserting tier ${s.achievement_id}-${s.tier}:`,t)}},Je=async()=>{const r=[{level:1,xp_required:0,title:"Newcomer",description:"Welcome to the server!",color:"#6b7280"},{level:2,xp_required:100,title:"Novice",description:"Getting started",color:"#10b981"},{level:3,xp_required:250,title:"Apprentice",description:"Learning the ropes",color:"#3b82f6"},{level:4,xp_required:500,title:"Journeyman",description:"Making progress",color:"#8b5cf6"},{level:5,xp_required:1e3,title:"Adventurer",description:"Exploring the world",color:"#f59e0b"},{level:6,xp_required:1750,title:"Explorer",description:"Discovering new places",color:"#06b6d4"},{level:7,xp_required:2750,title:"Veteran",description:"Experienced player",color:"#84cc16"},{level:8,xp_required:4e3,title:"Expert",description:"Skilled and knowledgeable",color:"#f97316"},{level:9,xp_required:6e3,title:"Master",description:"Mastered the game",color:"#ef4444"},{level:10,xp_required:8500,title:"Champion",description:"Elite player",color:"#a855f7"},{level:11,xp_required:12e3,title:"Legend",description:"Legendary status",color:"#dc2626"},{level:12,xp_required:16500,title:"Mythic",description:"Mythical prowess",color:"#9333ea"},{level:13,xp_required:22500,title:"Ascended",description:"Beyond mortal limits",color:"#1d4ed8"},{level:14,xp_required:3e4,title:"Divine",description:"Divine power",color:"#059669"},{level:15,xp_required:4e4,title:"Transcendent",description:"Transcended reality",color:"#be123c"}];for(const s of r){const{error:t}=await f.from("level_definitions").upsert(s,{onConflict:"level"});t&&console.error(`Error upserting level ${s.level}:`,t)}},de=async()=>{const{data:r,error:s}=await f.from("achievement_definitions").select("*").order("id");return s?(console.error("Error fetching achievement definitions:",s),[]):r||[]},me=async()=>{const{data:r,error:s}=await f.from("achievement_tiers").select("*").order("achievement_id, tier");return s?(console.error("Error fetching achievement tiers:",s),[]):r||[]},he=async()=>{const{data:r,error:s}=await f.from("level_definitions").select("*").order("level");return s?(console.error("Error fetching level definitions:",s),[]):r||[]},Ge=async()=>{console.log("Initializing achievement system...");try{await Ze(),await He(),await Je(),console.log("Achievement system initialized successfully")}catch(r){console.error("Error initializing achievement system:",r)}},Xe=async()=>{try{const{data:r,error:s}=await f.rpc("sync_all_achievements");return s?(console.error("Error syncing achievements:",s),{success:!1,error:s.message}):{success:!0}}catch(r){return console.error("Error in syncAllPlayerAchievements:",r),{success:!1,error:"Unknown error occurred"}}},Qe=({className:r=""})=>{const[s,t]=o.useState(!1),[n,i]=o.useState(!1),[c,l]=o.useState({definitions:0,tiers:0,levels:0}),[g,j]=o.useState(null),{toast:m}=xe(),x=async()=>{t(!0);try{await Ge();const[w,v,T]=await Promise.all([de(),me(),he()]);l({definitions:w.length,tiers:v.length,levels:T.length}),m({title:"Achievement System Initialized",description:"All achievement definitions, tiers, and levels have been set up successfully."})}catch(w){console.error("Error initializing achievement system:",w),m({title:"Initialization Failed",description:"There was an error initializing the achievement system.",variant:"destructive"})}finally{t(!1)}},h=async()=>{i(!0);try{const w=await Xe();w.success?(j(new Date),m({title:"Achievement Sync Complete",description:"All player achievements have been synchronized successfully."})):m({title:"Sync Failed",description:w.error||"There was an error syncing achievements.",variant:"destructive"})}catch(w){console.error("Error syncing achievements:",w),m({title:"Sync Failed",description:"There was an error syncing achievements.",variant:"destructive"})}finally{i(!1)}},p=async()=>{try{const[w,v,T]=await Promise.all([de(),me(),he()]);l({definitions:w.length,tiers:v.length,levels:T.length})}catch(w){console.error("Error loading stats:",w)}};return je.useEffect(()=>{p()},[]),e.jsxs(N,{className:r,children:[e.jsx(P,{children:e.jsxs(A,{className:"flex items-center gap-2",children:[e.jsx(Q,{className:"w-5 h-5"}),"Achievement System Management"]})}),e.jsxs(k,{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsxs("div",{className:"text-center p-4 bg-muted rounded-lg",children:[e.jsx("div",{className:"text-2xl font-bold text-blue-600",children:c.definitions}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"Achievement Types"})]}),e.jsxs("div",{className:"text-center p-4 bg-muted rounded-lg",children:[e.jsx("div",{className:"text-2xl font-bold text-green-600",children:c.tiers}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"Achievement Tiers"})]}),e.jsxs("div",{className:"text-center p-4 bg-muted rounded-lg",children:[e.jsx("div",{className:"text-2xl font-bold text-purple-600",children:c.levels}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"Level Definitions"})]})]}),g&&e.jsxs("div",{className:"flex items-center gap-2 p-3 bg-green-50 border border-green-200 rounded-lg",children:[e.jsx(Z,{className:"w-4 h-4 text-green-600"}),e.jsxs("span",{className:"text-sm text-green-800",children:["Last synced: ",g.toLocaleString()]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("div",{className:"flex items-center gap-2",children:e.jsx(b,{onClick:x,disabled:s,className:"flex-1",variant:"outline",children:s?e.jsxs(e.Fragment,{children:[e.jsx(R,{className:"w-4 h-4 mr-2 animate-spin"}),"Initializing..."]}):e.jsxs(e.Fragment,{children:[e.jsx(G,{className:"w-4 h-4 mr-2"}),"Initialize System"]})})}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsx(b,{onClick:h,disabled:n||c.definitions===0,className:"flex-1",children:n?e.jsxs(e.Fragment,{children:[e.jsx(R,{className:"w-4 h-4 mr-2 animate-spin"}),"Syncing..."]}):e.jsxs(e.Fragment,{children:[e.jsx(R,{className:"w-4 h-4 mr-2"}),"Sync All Players"]})})}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsx(b,{onClick:p,variant:"ghost",className:"flex-1",children:"Refresh Stats"})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm font-medium",children:"System Status"}),e.jsx(S,{variant:c.definitions>0?"default":"destructive",children:c.definitions>0?"Ready":"Not Initialized"})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm font-medium",children:"Achievement Coverage"}),e.jsxs(S,{variant:c.tiers>=50?"default":"secondary",children:[c.tiers," tiers"]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm font-medium",children:"Level System"}),e.jsxs(S,{variant:c.levels>=10?"default":"secondary",children:[c.levels," levels"]})]})]}),c.definitions===0&&e.jsxs("div",{className:"flex items-center gap-2 p-3 bg-yellow-50 border border-yellow-200 rounded-lg",children:[e.jsx($,{className:"w-4 h-4 text-yellow-600"}),e.jsx("span",{className:"text-sm text-yellow-800",children:"Achievement system needs to be initialized before syncing players."})]})]})]})},Ye=()=>{const[r,s]=o.useState(!1),[t,n]=o.useState(0),[i,c]=o.useState(null),[l,g]=o.useState(null),j=async()=>{s(!0),n(0),c(null),g(null);try{const m=setInterval(()=>{n(h=>Math.min(h+10,90))},1e3),x=await ve();clearInterval(m),n(100),c(x)}catch(m){g(m instanceof Error?m.message:"An error occurred during the update")}finally{s(!1)}};return e.jsxs(N,{className:"w-full max-w-2xl",children:[e.jsxs(P,{children:[e.jsxs(A,{className:"flex items-center gap-2",children:[e.jsx(J,{className:"h-5 w-5"}),"Comprehensive Stats Update"]}),e.jsx(z,{children:"Update all player stats in the database to include all possible stats from possible_stats.json. This ensures that all players have complete stat data even if they don't have individual JSON files."})]}),e.jsxs(k,{className:"space-y-4",children:[l&&e.jsxs(B,{variant:"destructive",children:[e.jsx($,{className:"h-4 w-4"}),e.jsx(O,{children:l})]}),i&&e.jsxs(B,{variant:i.failed===0?"default":"destructive",children:[i.failed===0?e.jsx(Z,{className:"h-4 w-4"}):e.jsx($,{className:"h-4 w-4"}),e.jsxs(O,{children:["Update completed: ",i.success," successful, ",i.failed," failed out of ",i.total," total players."]})]}),r&&e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between text-sm text-muted-foreground",children:[e.jsx("span",{children:"Updating player stats..."}),e.jsxs("span",{children:[t,"%"]})]}),e.jsx(L,{value:t,className:"w-full"})]}),e.jsx(b,{onClick:j,disabled:r,className:"w-full",children:r?e.jsxs(e.Fragment,{children:[e.jsx(K,{className:"mr-2 h-4 w-4 animate-spin"}),"Updating Stats..."]}):e.jsxs(e.Fragment,{children:[e.jsx(J,{className:"mr-2 h-4 w-4"}),"Update All Player Stats"]})}),e.jsxs("div",{className:"text-sm text-muted-foreground space-y-1",children:[e.jsx("p",{children:e.jsx("strong",{children:"What this does:"})}),e.jsxs("ul",{className:"list-disc list-inside space-y-1 ml-4",children:[e.jsx("li",{children:"Fetches all possible stats from possible_stats.json"}),e.jsx("li",{children:"Initializes all stats to 0 for every player"}),e.jsx("li",{children:"Merges existing database stats and JSON file stats"}),e.jsx("li",{children:"Updates the player_stats table with comprehensive data"}),e.jsx("li",{children:"Ensures all players have complete stat information"})]})]})]})]})};class pe{static async syncPlayerStats(s){try{console.log(`Syncing stats for player ${s}...`);const t=await te(s),{error:n}=await f.from("player_stats").upsert({player_uuid:s,stats:t,last_updated:Math.floor(Date.now()/1e3)});return n?(console.error(`Error syncing stats for ${s}:`,n),!1):(console.log(`Successfully synced stats for player ${s}`),!0)}catch(t){return console.error(`Error in syncPlayerStats for ${s}:`,t),!1}}static async syncMultiplePlayerStats(s){const t={success:0,failed:0,errors:[]},n=5;console.log(`Starting sync for ${s.length} players...`);for(let i=0;i<s.length;i+=n){const c=s.slice(i,i+n),l=c.map(async m=>{try{const x=await this.syncPlayerStats(m);return{uuid:m,success:x}}catch(x){return console.error(`Error processing ${m}:`,x),{uuid:m,success:!1,error:x.message}}});(await Promise.all(l)).forEach(({uuid:m,success:x,error:h})=>{x?t.success++:(t.failed++,h&&t.errors.push(`${m}: ${h}`))});const j=i+c.length;console.log(`Processed ${j}/${s.length} players (${t.success} success, ${t.failed} failed)`),i+n<s.length&&await new Promise(m=>setTimeout(m,200))}return console.log(`Sync complete: ${t.success} successful, ${t.failed} failed`),t}static async syncAllPlayerStats(){try{console.log("Starting comprehensive stats sync for all players...");const{data:s,error:t}=await f.from("players").select("uuid");if(t)return console.error("Error fetching player UUIDs:",t),{success:0,failed:0,total:0,errors:[t.message]};const n=(s==null?void 0:s.map(g=>g.uuid))||[];console.log(`Found ${n.length} players to sync`);const{success:i,failed:c,errors:l}=await this.syncMultiplePlayerStats(n);return{success:i,failed:c,total:n.length,errors:l}}catch(s){return console.error("Error in syncAllPlayerStats:",s),{success:0,failed:0,total:0,errors:[s.message]}}}static async initializePlayerStatsTable(){try{console.log("Initializing player stats table with all possible stats...");const{data:s,error:t}=await f.from("players").select("uuid");if(t)return console.error("Error fetching player UUIDs:",t),!1;const n=(s==null?void 0:s.map(l=>l.uuid))||[];console.log(`Found ${n.length} players to initialize`);const i=n.map(l=>({player_uuid:l,stats:this.createEmptyStatsObject(),last_updated:Math.floor(Date.now()/1e3)})),{error:c}=await f.from("player_stats").upsert(i,{onConflict:"player_uuid",ignoreDuplicates:!1});return c?(console.error("Error upserting player stats:",c),!1):(console.log(`Successfully initialized stats for ${n.length} players`),!0)}catch(s){return console.error("Error in initializePlayerStatsTable:",s),!1}}static createEmptyStatsObject(){const s={};return Object.entries(ye).forEach(([t,n])=>{typeof n=="object"&&Object.keys(n).forEach(i=>{const c=this.getFlatStatName(t,i);s[c]=0})}),s}static getFlatStatName(s,t){switch(s){case"custom":return t;case"mined":return`${t}_mined`;case"used":return`${t}_used`;case"crafted":return`${t}_crafted`;case"killed":return`${t}_killed`;case"killed_by":return`killed_by_${t}`;case"picked_up":return`${t}_picked_up`;case"dropped":return`${t}_dropped`;case"broken":return`${t}_broken`;default:return`${s}_${t}`}}static async getPlayerStatsSummary(s){try{const t=await te(s),n=Object.keys(t).length,i=Object.values(t).filter(l=>l>0).length,c={};return Object.entries(t).forEach(([l,g])=>{const j=this.getStatCategory(l);c[j]=(c[j]||0)+(g>0?1:0)}),{totalStats:n,nonZeroStats:i,categories:c}}catch(t){return console.error(`Error getting stats summary for ${s}:`,t),{totalStats:0,nonZeroStats:0,categories:{}}}}static getStatCategory(s){return s.endsWith("_mined")?"mined":s.endsWith("_used")?"used":s.endsWith("_crafted")?"crafted":s.endsWith("_killed")?"killed":s.startsWith("killed_by_")?"killed_by":s.endsWith("_picked_up")?"picked_up":s.endsWith("_dropped")?"dropped":s.endsWith("_broken")?"broken":"custom"}}const es=()=>{const[r,s]=o.useState(!1),[t,n]=o.useState(0),[i,c]=o.useState(null),[l,g]=o.useState(""),j=async()=>{s(!0),n(0),c(null),g("Starting comprehensive stats sync...");try{if(g("Initializing player stats table..."),n(10),!await pe.initializePlayerStatsTable())throw new Error("Failed to initialize player stats table");g("Syncing comprehensive stats for all players..."),n(30);const p=await pe.syncAllPlayerStats();n(100),g("Sync completed!"),c(p),console.log("Comprehensive stats sync completed:",p)}catch(h){console.error("Error during comprehensive stats sync:",h),g("Sync failed!"),c({success:0,failed:0,total:0,errors:[h instanceof Error?h.message:"Unknown error"]})}finally{s(!1)}},m=()=>r?e.jsx(K,{className:"h-4 w-4 animate-spin"}):i?i.failed===0?e.jsx(Z,{className:"h-4 w-4 text-green-500"}):i.success>0?e.jsx($,{className:"h-4 w-4 text-yellow-500"}):e.jsx(ge,{className:"h-4 w-4 text-red-500"}):e.jsx(R,{className:"h-4 w-4"}),x=()=>r?"Syncing...":i?i.failed===0?"Completed successfully":i.success>0?"Completed with errors":"Failed":"Ready to sync";return e.jsxs(N,{children:[e.jsxs(P,{children:[e.jsxs(A,{className:"flex items-center gap-2",children:[m(),"Comprehensive Stats Sync"]}),e.jsx(z,{children:"Sync all player stats with comprehensive data from possible_stats.json and individual player files. This ensures all players have all possible stats initialized and up-to-date."})]}),e.jsxs(k,{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("span",{className:"text-sm font-medium",children:["Status: ",x()]}),i&&e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(S,{variant:"outline",className:"text-green-600",children:[i.success," Success"]}),e.jsxs(S,{variant:"outline",className:"text-red-600",children:[i.failed," Failed"]}),e.jsxs(S,{variant:"outline",children:[i.total," Total"]})]})]}),r&&e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{children:l}),e.jsxs("span",{children:[t,"%"]})]}),e.jsx(L,{value:t,className:"w-full"})]}),e.jsx("div",{className:"flex gap-2",children:e.jsx(b,{onClick:j,disabled:r,className:"flex-1",children:r?e.jsxs(e.Fragment,{children:[e.jsx(K,{className:"mr-2 h-4 w-4 animate-spin"}),"Syncing All Players..."]}):e.jsxs(e.Fragment,{children:[e.jsx(R,{className:"mr-2 h-4 w-4"}),"Sync All Player Stats"]})})}),i&&e.jsxs("div",{className:"space-y-3",children:[e.jsx(B,{children:e.jsx(O,{children:e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Total Players:"}),e.jsx("span",{className:"font-medium",children:i.total})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Successfully Synced:"}),e.jsx("span",{className:"font-medium text-green-600",children:i.success})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Failed:"}),e.jsx("span",{className:"font-medium text-red-600",children:i.failed})]}),i.success>0&&e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Success Rate:"}),e.jsxs("span",{className:"font-medium",children:[Math.round(i.success/i.total*100),"%"]})]})]})})}),i.errors.length>0&&e.jsxs(B,{variant:"destructive",children:[e.jsx($,{className:"h-4 w-4"}),e.jsx(O,{children:e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"font-medium",children:["Errors (",i.errors.length,"):"]}),e.jsxs("div",{className:"max-h-32 overflow-y-auto space-y-1",children:[i.errors.slice(0,5).map((h,p)=>e.jsx("div",{className:"text-sm",children:h},p)),i.errors.length>5&&e.jsxs("div",{className:"text-sm text-muted-foreground",children:["... and ",i.errors.length-5," more errors"]})]})]})})]})]}),e.jsxs("div",{className:"text-sm text-muted-foreground space-y-1",children:[e.jsx("p",{children:"This process will:"}),e.jsxs("ul",{className:"list-disc list-inside space-y-1 ml-4",children:[e.jsx("li",{children:"Initialize all possible stats from possible_stats.json for every player"}),e.jsx("li",{children:"Fetch individual player stats from JSON files"}),e.jsx("li",{children:"Merge with existing database stats"}),e.jsx("li",{children:"Update the player_stats table with comprehensive data"})]}),e.jsxs("p",{className:"mt-2",children:[e.jsx("strong",{children:"Note:"})," This may take several minutes depending on the number of players."]})]})]})]})},ss=()=>{const[r,s]=o.useState(!1),[t,n]=o.useState(null),[i,c]=o.useState(0),[l,g]=o.useState(null),[j,m]=o.useState(null);o.useEffect(()=>{x()},[]);const x=async()=>{try{const v=await ae.getCacheStats();n(v)}catch(v){console.error("Failed to load cache stats:",v)}},h=async()=>{s(!0),m(null);try{await ae.clearAllCaches(),await x(),m(null)}catch(v){m(v instanceof Error?v.message:"Failed to clear cache")}finally{s(!1)}},p=async()=>{s(!0),m(null),c(0),g(null);try{const v=await Ne();console.log(`Found ${v.length} players to preload`);const T=v.length;let F=0;const a=()=>{F+=20;const u=Math.min(F/T*100,90);c(u)};await be(v),c(100),g({total:T,success:T,failed:0}),await x()}catch(v){m(v instanceof Error?v.message:"Failed to preload cache")}finally{s(!1)}},w=async()=>{await x()};return e.jsxs(N,{className:"w-full max-w-4xl",children:[e.jsxs(P,{children:[e.jsxs(A,{className:"flex items-center gap-2",children:[e.jsx(J,{className:"h-5 w-5"}),"Cache Management"]}),e.jsx(z,{children:"Manage player stats caching to optimize database egress and improve performance."})]}),e.jsxs(k,{className:"space-y-6",children:[j&&e.jsxs(B,{variant:"destructive",children:[e.jsx($,{className:"h-4 w-4"}),e.jsx(O,{children:j})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"p-4 border rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(Ke,{className:"h-4 w-4 text-blue-500"}),e.jsx("span",{className:"font-medium",children:"Memory Usage"})]}),e.jsx("div",{className:"text-2xl font-bold",children:t?`${(t.memoryUsage/1024/1024).toFixed(2)} MB`:"N/A"})]}),e.jsxs("div",{className:"p-4 border rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(Re,{className:"h-4 w-4 text-green-500"}),e.jsx("span",{className:"font-medium",children:"Cache Size"})]}),e.jsx("div",{className:"text-2xl font-bold",children:t?t.cacheSize.toLocaleString():"N/A"})]}),e.jsxs("div",{className:"p-4 border rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(we,{className:"h-4 w-4 text-purple-500"}),e.jsx("span",{className:"font-medium",children:"Hit Rate"})]}),e.jsx("div",{className:"text-2xl font-bold",children:t?`${(t.hitRate*100).toFixed(1)}%`:"N/A"})]})]}),e.jsx(ee,{}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Cache Actions"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs(b,{onClick:w,variant:"outline",className:"w-full",children:[e.jsx(R,{className:"mr-2 h-4 w-4"}),"Refresh Stats"]}),e.jsx(b,{onClick:h,disabled:r,variant:"destructive",className:"w-full",children:r?e.jsxs(e.Fragment,{children:[e.jsx(K,{className:"mr-2 h-4 w-4 animate-spin"}),"Clearing..."]}):e.jsxs(e.Fragment,{children:[e.jsx(se,{className:"mr-2 h-4 w-4"}),"Clear All Caches"]})})]})]}),e.jsx(ee,{}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Cache Preloading"}),e.jsx(S,{variant:"secondary",children:"Preload frequently accessed player stats"})]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Preload the cache with all player stats to improve initial page load performance. This will fetch and cache stats for all players in the database."}),i>0&&i<100&&e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between text-sm text-muted-foreground",children:[e.jsx("span",{children:"Preloading cache..."}),e.jsxs("span",{children:[Math.round(i),"%"]})]}),e.jsx(L,{value:i,className:"w-full"})]}),l&&e.jsxs(B,{variant:l.failed===0?"default":"destructive",children:[l.failed===0?e.jsx(Z,{className:"h-4 w-4"}):e.jsx($,{className:"h-4 w-4"}),e.jsxs(O,{children:["Preloading completed: ",l.success," successful, ",l.failed," failed out of ",l.total," total players."]})]}),e.jsx(b,{onClick:p,disabled:r,className:"w-full",children:r?e.jsxs(e.Fragment,{children:[e.jsx(K,{className:"mr-2 h-4 w-4 animate-spin"}),"Preloading Cache..."]}):e.jsxs(e.Fragment,{children:[e.jsx(J,{className:"mr-2 h-4 w-4"}),"Preload All Player Stats"]})})]}),e.jsx(ee,{}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Cache Information"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium mb-2",children:"Cache Strategy"}),e.jsxs("ul",{className:"space-y-1 text-muted-foreground",children:[e.jsx("li",{children:"â€¢ Player stats: 5 minutes TTL"}),e.jsx("li",{children:"â€¢ Player profiles: 10 minutes TTL"}),e.jsx("li",{children:"â€¢ Leaderboards: 15 minutes TTL"}),e.jsx("li",{children:"â€¢ Achievements: 30 minutes TTL"})]})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium mb-2",children:"Features"}),e.jsxs("ul",{className:"space-y-1 text-muted-foreground",children:[e.jsx("li",{children:"â€¢ Redis with memory fallback"}),e.jsx("li",{children:"â€¢ Real-time cache invalidation"}),e.jsx("li",{children:"â€¢ Batch operations"}),e.jsx("li",{children:"â€¢ Automatic cleanup"})]})]})]})]})]})]})},ts=()=>{const[r,s]=o.useState(""),[t,n]=o.useState(!1),[i,c]=o.useState([]),[l,g]=o.useState([]),[j,m]=o.useState(0),[x,h]=o.useState(""),[p,w]=o.useState({}),v=(a,u)=>{if(console.log(`Calculating value for stat: ${a}`,u),a==="play"||a==="play_one_minute")return Math.floor((u[a]||0)/72e3);if(a==="walk"||a==="walk_one_cm"||a==="sprint")return Math.floor((u[a]||0)/100);{const y=u[a]||0;return console.log(`Direct stat lookup for ${a}:`,y),y}},T=async()=>{if(!r.trim()){alert("Please enter a player UUID");return}n(!0),c([]),g([]),m(0),h("");try{const{data:a,error:u}=await f.rpc("debug_get_player_info",{p_player_uuid:r});u?console.error("Error getting player info:",u):g(a||[]);try{const C=await ie(r);w(C),console.log("Comprehensive stats for player:",C)}catch(C){console.error("Error getting comprehensive stats:",C),w({})}const{data:y,error:E}=await f.rpc("calculate_player_achievements",{p_player_uuid:r,p_player_stats:p});if(E)console.error("Error calculating achievements:",E),h("Error calculating achievements: "+E.message);else if(console.log("Achievement calculation result:",y),y&&typeof y=="object"){const C=y;m(C.achievements_created||0),h(C.message||"Achievements calculated")}const{data:D,error:W}=await f.from("achievement_definitions").select(`
          id,
          name,
          stat,
          achievement_tiers (
            id,
            name,
            threshold,
            points,
            tier
          )
        `).order("id");if(W)console.error("Error getting achievement definitions:",W);else{const C=[];D==null||D.forEach(d=>{var _;(_=d.achievement_tiers)==null||_.forEach(M=>{const q=v(d.stat,p),fe=q>=M.threshold;C.push({achievement_id:d.id,achievement_name:d.name,tier_name:M.name,stat_name:d.stat,current_value:q,threshold:M.threshold,qualifies:fe,points:M.points})})}),c(C)}}catch(a){console.error("Error in achievement test:",a),h("Error: "+a.message)}finally{n(!1)}},F=async()=>{if(!r.trim()){alert("Please enter a player UUID");return}n(!0),h("");try{const a=await ie(r),{data:u,error:y}=await f.rpc("calculate_player_achievements",{p_player_uuid:r,p_player_stats:a});if(y)console.error("Error creating achievements:",y),h("Error: "+y.message);else if(console.log("Achievement creation result:",u),u&&typeof u=="object"){const E=u;m(E.achievements_created||0),h(E.message||"Achievements created")}}catch(a){console.error("Error creating achievements:",a),h("Error: "+a.message)}finally{n(!1)}};return e.jsxs(N,{children:[e.jsxs(P,{children:[e.jsx(A,{children:"Achievement Debug Panel"}),e.jsx(z,{children:"Test achievement calculations and manually create achievements for players"})]}),e.jsxs(k,{className:"space-y-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"Player UUID"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(V,{value:r,onChange:a=>s(a.target.value),placeholder:"Enter player UUID (e.g., 75c88432-a4ed-4f01-a660-b98783a0ed1b)"}),e.jsx(b,{onClick:T,disabled:t,children:t?"Testing...":"Test Achievements"}),e.jsx(b,{onClick:F,disabled:t,variant:"outline",children:t?"Creating...":"Create Achievements"})]})]}),x&&e.jsxs("div",{className:"p-4 bg-muted rounded-lg",children:[e.jsx("h3",{className:"font-medium mb-2",children:"Results:"}),e.jsx("p",{className:"text-sm",children:x}),j>0&&e.jsxs("p",{className:"text-sm text-green-600 mt-1",children:["Achievements Created: ",j]})]}),l.length>0&&e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-lg font-medium",children:"Player Info"}),e.jsx("div",{className:"max-h-96 overflow-y-auto space-y-2",children:l.map((a,u)=>{var y;return e.jsxs("div",{className:"flex items-center justify-between p-2 bg-muted rounded",children:[e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:a.player_name}),e.jsxs("div",{className:"text-sm text-muted-foreground",children:["UUID: ",a.player_uuid]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(S,{variant:"outline",children:["Level: ",a.level||1]}),e.jsxs(S,{variant:"secondary",children:["XP: ",((y=a.total_xp)==null?void 0:y.toLocaleString())||0]}),e.jsxs(S,{variant:"outline",children:["Last Seen: ",new Date(a.last_seen*1e3).toLocaleDateString()]})]})]},u)})})]}),Object.keys(p).length>0&&e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-lg font-medium",children:"Player Stats Summary"}),e.jsxs("div",{className:"max-h-96 overflow-y-auto space-y-2",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("strong",{children:"Playtime (hours):"})," ",Math.floor((p.play_one_minute||0)/72e3)]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Blocks Placed:"})," ",p.use_dirt||0]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Blocks Broken:"})," ",p.mine_ground||0]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Mob Kills:"})," ",p.kill_any||0]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Walk Distance (blocks):"})," ",Math.floor((p.walk_one_cm||0)/100)]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Diamond Ore Mined:"})," ",p.mine_diamond_ore||0]})]}),e.jsxs("div",{className:"mt-4",children:[e.jsx("h4",{className:"font-medium text-sm",children:"Available Stats (first 20):"}),e.jsx("div",{className:"text-xs bg-gray-100 p-2 rounded max-h-32 overflow-y-auto",children:Object.entries(p).filter(([,a])=>a>0).slice(0,20).map(([a,u])=>e.jsxs("div",{className:"flex justify-between",children:[e.jsxs("span",{children:[a,":"]}),e.jsx("span",{children:u.toLocaleString()})]},a))})]})]})]}),i.length>0&&e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-lg font-medium",children:"Achievement Calculations"}),e.jsx("div",{className:"max-h-96 overflow-y-auto space-y-2",children:i.map((a,u)=>e.jsxs("div",{className:"flex items-center justify-between p-2 bg-muted rounded",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"font-medium",children:[a.achievement_name," - ",a.tier_name]}),e.jsxs("div",{className:"text-sm text-muted-foreground",children:["Stat: ",a.stat_name," | Value: ",a.current_value," / ",a.threshold]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(S,{variant:a.qualifies?"default":"secondary",children:a.qualifies?"Qualifies":"Doesn't Qualify"}),e.jsxs(S,{variant:"outline",children:[a.points," XP"]})]})]},u))})]})]})]})},as=[{id:"population",name:"Population Growth",description:"Grow your town population",stat:"population",color:"from-green-500 to-emerald-600",tiers:[{tier:1,name:"Small Settlement",description:"Reach 3 residents",threshold:3,icon:_e,points:50},{tier:2,name:"Growing Community",description:"Reach 5 residents",threshold:5,icon:Le,points:100},{tier:3,name:"Thriving Town",description:"Reach 10 residents",threshold:10,icon:ne,points:150},{tier:4,name:"Major City",description:"Reach 15 residents",threshold:15,icon:ne,points:200},{tier:5,name:"Metropolis",description:"Reach 20 residents",threshold:20,icon:Oe,points:250},{tier:6,name:"Mega City",description:"Reach 30 residents",threshold:30,icon:re,points:300},{tier:7,name:"Capital City",description:"Reach 40 residents",threshold:40,icon:Se,points:350},{tier:8,name:"Empire Capital",description:"Reach 50 residents",threshold:50,icon:G,points:400}]},{id:"nation_member",name:"Nation Member",description:"Join a nation and become part of something greater",stat:"nation_member",color:"from-blue-500 to-purple-600",tiers:[{tier:1,name:"Nation Citizen",description:"Join a nation",threshold:1,icon:ke,points:100}]},{id:"independent_town",name:"Independent Spirit",description:"Maintain independence as a sovereign town",stat:"independent",color:"from-orange-500 to-red-600",tiers:[{tier:1,name:"Independent Town",description:"Remain independent",threshold:1,icon:ze,points:150}]},{id:"capital_town",name:"Capital Status",description:"Become the capital of your nation",stat:"capital",color:"from-yellow-500 to-amber-600",tiers:[{tier:1,name:"Nation Capital",description:"Become a nation capital",threshold:1,icon:re,points:200}]}],is=async()=>{try{console.log("Populating town achievement database...");for(const r of as){const{error:s}=await f.from("town_achievement_definitions").upsert({id:r.id,name:r.name,description:r.description,stat:r.stat},{onConflict:"id"});if(s){console.error(`Error inserting achievement definition ${r.id}:`,s);continue}for(const t of r.tiers){const{error:n}=await f.from("town_achievement_tiers").upsert({achievement_id:r.id,tier:t.tier,name:t.name,description:t.description,threshold:t.threshold,points:t.points,icon:"trophy",color:r.color},{onConflict:"achievement_id,tier"});n&&console.error(`Error inserting tier ${t.tier} for achievement ${r.id}:`,n)}}return console.log("Town achievement database populated successfully"),{success:!0,message:"Town achievements populated successfully"}}catch(r){return console.error("Error populating town achievements:",r),{success:!1,message:"Failed to populate achievements"}}},ns=async()=>{try{const{data:r,error:s}=await f.rpc("sync_all_town_achievements");return s?(console.error("Error syncing town achievements:",s),{success:!1,message:s.message}):{success:!0,message:"Town achievements synced successfully"}}catch(r){return console.error("Error in syncAllTownAchievements:",r),{success:!1,message:"Failed to sync achievements"}}};function rs(){const{sendThorResponse:r,isConnected:s}=Te(),[t,n]=o.useState(""),[i,c]=o.useState(!0),[l,g]=o.useState(le.getInstance().getConfig()),[j,m]=o.useState(!1),[x,h]=o.useState(""),[p,w]=o.useState(!1),v=async()=>{if(t.trim()){m(!0);try{await r(t),n("")}catch(a){console.error("Failed to send test response:",a)}finally{m(!1)}}},T=(a,u)=>{const y={...l,[a]:u};g(y),le.getInstance().updateConfig(y)},F=async()=>{w(!0),h("");try{const a=async(E,D="",W="")=>{const{data:C,error:d}=await f.storage.from(E).list(D,{limit:1e3});if(d)return`${W}Error listing ${E}/${D}: ${d.message||d}
`;if(!C||C.length===0)return"";let _="";for(const M of C){const q=D?`${D}/${M.name}`:M.name;M.metadata?_+=`${W}- ${q}
`:(_+=`${W}[Folder] ${q}/
`,_+=await a(E,q,W+"  "))}return _},u=await a("ai-docs",""),y=await a("wiki","");h(`AI Docs:
`+(u||"No files found.")+`

Wiki Docs:
`+(y||"No files found."))}catch(a){h("Error: "+((a==null?void 0:a.message)||(a==null?void 0:a.toString())||"Unknown error"))}finally{w(!1)}};return e.jsxs(N,{className:"w-full",children:[e.jsx(P,{children:e.jsxs(A,{className:"flex items-center gap-2",children:[e.jsx(Ce,{className:"h-5 w-5"}),"Thor Minecraft Integration"]})}),e.jsxs(k,{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(S,{variant:s?"default":"secondary",children:s?"Connected":"Disconnected"}),e.jsx(S,{variant:i?"default":"secondary",children:i?"Enabled":"Disabled"})]}),e.jsx(Be,{checked:i,onCheckedChange:c})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("h3",{className:"text-lg font-semibold flex items-center gap-2",children:[e.jsx(Q,{className:"h-4 w-4"}),"Configuration"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(U,{htmlFor:"responsePrefix",children:"Response Prefix"}),e.jsx(V,{id:"responsePrefix",value:l.responsePrefix,onChange:a=>T("responsePrefix",a.target.value),placeholder:"âš¡ Thor: "})]}),e.jsxs("div",{children:[e.jsx(U,{htmlFor:"maxLength",children:"Max Response Length"}),e.jsx(V,{id:"maxLength",type:"number",value:l.maxResponseLength,onChange:a=>T("maxResponseLength",parseInt(a.target.value)),placeholder:"200"})]})]}),e.jsxs("div",{children:[e.jsx(U,{children:"Trigger Phrases"}),e.jsx("div",{className:"flex flex-wrap gap-2 mt-2",children:l.triggerWords.map((a,u)=>e.jsx(S,{variant:"outline",className:"text-xs",children:a},u))})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("h3",{className:"text-lg font-semibold flex items-center gap-2",children:[e.jsx(Ve,{className:"h-4 w-4"}),"Test Thor Response"]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(V,{value:t,onChange:a=>n(a.target.value),placeholder:"Test message to send as Thor...",className:"flex-1"}),e.jsx(b,{onClick:v,disabled:!s||j||!t.trim(),className:"bg-gradient-to-br from-amber-500 to-orange-600 hover:from-amber-600 hover:to-orange-700",children:j?"Sending...":"Send Test"})]}),e.jsx("div",{className:"flex gap-2",children:e.jsx(b,{variant:"outline",onClick:()=>n("Hey Thor, what towns are available?"),size:"sm",children:"Load Test Question"})}),e.jsx("div",{className:"flex gap-2",children:e.jsx(b,{variant:"outline",onClick:F,disabled:p,size:"sm",children:p?"Testing...":"Test Supabase Buckets"})}),x&&e.jsx("div",{className:"bg-muted/50 rounded p-2 text-xs whitespace-pre-wrap mt-2",children:x})]}),e.jsxs("div",{className:"bg-muted/50 rounded-lg p-4",children:[e.jsxs("h4",{className:"font-semibold mb-2 flex items-center gap-2",children:[e.jsx(Pe,{className:"h-4 w-4"}),"How it works"]}),e.jsxs("ul",{className:"text-sm space-y-1 text-muted-foreground",children:[e.jsx("li",{children:'â€¢ Players in Minecraft can say "Hey Thor" followed by their question'}),e.jsx("li",{children:"â€¢ Thor will automatically respond with AI-generated answers"}),e.jsxs("li",{children:["â€¢ Responses are limited to ",l.maxResponseLength," characters for Minecraft chat"]}),e.jsx("li",{children:"â€¢ Thor has access to all Nordics database data and AI documents"})]})]})]})]})}class H{static async checkWikiPagesStatus(){try{const{data:s}=await f.from("towns").select("name"),{data:t}=await f.from("nations").select("name"),{data:n}=await f.storage.from("wiki").list("Nordics/towns"),{data:i}=await f.storage.from("wiki").list("Nordics/nations"),c=s||[],l=t||[],g=n||[],j=i||[],m=c.filter(h=>g.some(p=>p.name===`${h.name.replace(/[^a-zA-Z0-9]/g,"_")}.md`)).length,x=l.filter(h=>j.some(p=>p.name===`${h.name.replace(/[^a-zA-Z0-9]/g,"_")}.md`)).length;return[{entity_type:"towns",total_count:c.length,pages_exist:m,missing_pages:c.length-m},{entity_type:"nations",total_count:l.length,pages_exist:x,missing_pages:l.length-x}]}catch(s){throw console.error("Error checking wiki pages status:",s),s}}static async syncAllWikiPages(){try{I.info("ðŸ”„ Starting wiki pages sync...");const s=await fetch("https://erdconvorgecupvavlwv.supabase.co/functions/v1/sync-all-wiki-pages",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImVyZGNvbnZvcmdlY3VwdmF2bHd2Iiwicm9sZSI6InNlcnZpY2Vfcm9sZSIsImlhdCI6MTc0OTU4Mzg4NywiZXhwIjoyMDY1MTU5ODg3fQ.eQCYcODSB3Tb6z47iXMi_oqHmKaTqeVM1MGoSgx4MUk"}});if(!s.ok){const n=await s.json();throw console.error("Edge function error:",n),I.error("âŒ Failed to create wiki pages"),new Error(n.error||"Failed to create wiki pages")}const t=await s.json();return t.success?I.success(`âœ… Wiki pages sync completed! Created ${t.results.towns.created} towns and ${t.results.nations.created} nations`):I.error("âŒ Wiki pages sync failed"),t.results}catch(s){throw console.error("Error syncing wiki pages:",s),I.error("âŒ Failed to sync wiki pages"),s}}static async createSingleWikiPage(s,t,n){try{I.info(`ðŸ”„ Creating wiki page for ${s}: ${n}`);const i=await fetch("https://erdconvorgecupvavlwv.supabase.co/functions/v1/create-wiki-page",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImVyZGNvbnZvcmdlY3VwdmF2bHd2Iiwicm9sZSI6InNlcnZpY2Vfcm9sZSIsImlhdCI6MTc0OTU4Mzg4NywiZXhwIjoyMDY1MTU5ODg3fQ.eQCYcODSB3Tb6z47iXMi_oqHmKaTqeVM1MGoSgx4MUk"},body:JSON.stringify({entity_type:s,entity_id:t,entity_name:n})});if(!i.ok){const l=await i.json();throw console.error("Edge function error:",l),I.error(`âŒ Failed to create wiki page for ${n}`),new Error(l.error||`Failed to create wiki page for ${n}`)}(await i.json()).success?I.success(`âœ… Wiki page created for ${n}`):I.error(`âŒ Failed to create wiki page for ${n}`)}catch(i){throw console.error(`Error creating wiki page for ${n}:`,i),I.error(`âŒ Failed to create wiki page for ${n}`),i}}static async getWikiPagesSummary(){try{const s=await this.checkWikiPagesStatus(),t=s.find(i=>i.entity_type==="towns"),n=s.find(i=>i.entity_type==="nations");return{totalTowns:(t==null?void 0:t.total_count)||0,totalNations:(n==null?void 0:n.total_count)||0,townsWithPages:(t==null?void 0:t.pages_exist)||0,nationsWithPages:(n==null?void 0:n.pages_exist)||0,missingTownPages:(t==null?void 0:t.missing_pages)||0,missingNationPages:(n==null?void 0:n.missing_pages)||0}}catch(s){return console.error("Error getting wiki pages summary:",s),{totalTowns:0,totalNations:0,townsWithPages:0,nationsWithPages:0,missingTownPages:0,missingNationPages:0}}}static async isAutoWikiEnabled(){try{const{data:s}=await f.from("towns").select("name").limit(1),{data:t}=await f.from("nations").select("name").limit(1);return!0}catch(s){return console.error("Error checking auto wiki status:",s),!1}}static async getRecentWikiActivity(){try{const{data:s}=await f.from("towns").select("name, created_at").gte("created_at",new Date(Date.now()-6048e5).toISOString()).order("created_at",{ascending:!1}).limit(10),{data:t}=await f.from("nations").select("name, created_at").gte("created_at",new Date(Date.now()-7*24*60*60*1e3).toISOString()).order("created_at",{ascending:!1}).limit(10);return{recentTowns:s||[],recentNations:t||[]}}catch(s){return console.error("Error getting recent wiki activity:",s),{recentTowns:[],recentNations:[]}}}}function ls(){const[r,s]=o.useState(!1),[t,n]=o.useState(!1),[i,c]=o.useState([]),[l,g]=o.useState({totalTowns:0,totalNations:0,townsWithPages:0,nationsWithPages:0,missingTownPages:0,missingNationPages:0}),[j,m]=o.useState(!1),[x,h]=o.useState({recentTowns:[],recentNations:[]});o.useEffect(()=>{p()},[]);const p=async()=>{s(!0);try{const[a,u,y,E]=await Promise.all([H.checkWikiPagesStatus(),H.getWikiPagesSummary(),H.isAutoWikiEnabled(),H.getRecentWikiActivity()]);c(a),g(u),m(y),h(E)}catch(a){console.error("Failed to load status:",a)}finally{s(!1)}},w=async()=>{n(!0);try{await H.syncAllWikiPages(),await p()}catch(a){console.error("Failed to sync wiki pages:",a)}finally{n(!1)}},v=()=>l.totalTowns===0?0:l.townsWithPages/l.totalTowns*100,T=()=>l.totalNations===0?0:l.nationsWithPages/l.totalNations*100,F=()=>{const a=l.totalTowns+l.totalNations;return a===0?0:(l.townsWithPages+l.nationsWithPages)/a*100};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs(N,{children:[e.jsxs(P,{children:[e.jsxs(A,{className:"flex items-center gap-2",children:[e.jsx(ue,{className:"h-5 w-5"}),"Automatic Wiki Page Manager"]}),e.jsx(z,{children:"Automatically create wiki pages for all towns and nations in the Nordics folder"})]}),e.jsxs(k,{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsx(N,{children:e.jsx(k,{className:"pt-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium",children:"Overall Progress"}),e.jsxs("p",{className:"text-2xl font-bold",children:[Math.round(F()),"%"]})]}),e.jsx(L,{value:F(),className:"w-16"})]})})}),e.jsx(N,{children:e.jsx(k,{className:"pt-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium",children:"Towns"}),e.jsxs("p",{className:"text-2xl font-bold",children:[l.townsWithPages,"/",l.totalTowns]})]}),e.jsx(L,{value:v(),className:"w-16"})]})})}),e.jsx(N,{children:e.jsx(k,{className:"pt-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium",children:"Nations"}),e.jsxs("p",{className:"text-2xl font-bold",children:[l.nationsWithPages,"/",l.totalNations]})]}),e.jsx(L,{value:T(),className:"w-16"})]})})})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(S,{variant:j?"default":"destructive",children:j?e.jsxs(e.Fragment,{children:[e.jsx(Z,{className:"h-3 w-3 mr-1"}),"Auto Wiki Enabled"]}):e.jsxs(e.Fragment,{children:[e.jsx($,{className:"h-3 w-3 mr-1"}),"Auto Wiki Disabled"]})}),e.jsx("span",{className:"text-sm text-muted-foreground",children:j?"New towns and nations will automatically get wiki pages created":"Automatic wiki page creation is not set up"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(b,{onClick:w,disabled:t||r,className:"flex items-center gap-2",children:[t?e.jsx(K,{className:"h-4 w-4 animate-spin"}):e.jsx(qe,{className:"h-4 w-4"}),t?"Syncing...":"Sync All Wiki Pages"]}),e.jsxs(b,{onClick:p,disabled:r,variant:"outline",className:"flex items-center gap-2",children:[e.jsx(R,{className:`h-4 w-4 ${r?"animate-spin":""}`}),"Refresh Status"]})]}),(l.missingTownPages>0||l.missingNationPages>0)&&e.jsxs(B,{children:[e.jsx($,{className:"h-4 w-4"}),e.jsxs(O,{children:["Missing wiki pages: ",l.missingTownPages," towns and ",l.missingNationPages,' nations. Click "Sync All Wiki Pages" to create them.']})]})]})]}),e.jsxs(N,{children:[e.jsx(P,{children:e.jsxs(A,{className:"flex items-center gap-2",children:[e.jsx(Q,{className:"h-5 w-5"}),"Detailed Status"]})}),e.jsx(k,{children:r?e.jsxs("div",{className:"flex items-center justify-center py-8",children:[e.jsx(K,{className:"h-6 w-6 animate-spin"}),e.jsx("span",{className:"ml-2",children:"Loading status..."})]}):e.jsx("div",{className:"space-y-4",children:i.map(a=>e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h4",{className:"font-medium capitalize",children:a.entity_type.replace("_"," ")}),e.jsxs(S,{variant:a.missing_pages===0?"default":"secondary",children:[a.pages_exist,"/",a.total_count," pages"]})]}),e.jsx("div",{className:"text-sm text-muted-foreground",children:a.missing_pages>0?`${a.missing_pages} pages missing`:"All pages created"}),e.jsx(L,{value:a.pages_exist/a.total_count*100})]},a.entity_type))})})]}),e.jsxs(N,{children:[e.jsxs(P,{children:[e.jsx(A,{children:"Recent Activity"}),e.jsx(z,{children:"Recently created towns and nations (last 7 days)"})]}),e.jsx(k,{children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium mb-2",children:"Recent Towns"}),x.recentTowns.length>0?e.jsx("div",{className:"space-y-1",children:x.recentTowns.map(a=>e.jsxs("div",{className:"text-sm",children:[e.jsx("span",{className:"font-medium",children:a.name}),e.jsx("span",{className:"text-muted-foreground ml-2",children:new Date(a.created_at).toLocaleDateString()})]},a.name))}):e.jsx("p",{className:"text-sm text-muted-foreground",children:"No recent towns"})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium mb-2",children:"Recent Nations"}),x.recentNations.length>0?e.jsx("div",{className:"space-y-1",children:x.recentNations.map(a=>e.jsxs("div",{className:"text-sm",children:[e.jsx("span",{className:"font-medium",children:a.name}),e.jsx("span",{className:"text-muted-foreground ml-2",children:new Date(a.created_at).toLocaleDateString()})]},a.name))}):e.jsx("p",{className:"text-sm text-muted-foreground",children:"No recent nations"})]})]})})]})]})}const cs=()=>{const[r,s]=o.useState(!1),[t,n]=o.useState(null),i=async()=>{if(confirm("âš ï¸ Are you sure you want to clear ALL town wiki pages? This action cannot be undone and will remove all content from town pages.")&&confirm("ðŸš¨ This will permanently clear the content of all town wiki pages. Are you absolutely certain?")){s(!0),n(null);try{const c=await Ee.clearTownWikiPages();n(c),c.success?I.success(`âœ… Successfully cleared ${c.clearedCount} town wiki pages`):I.error(`âŒ Failed to clear town wiki pages: ${c.error}`)}catch(c){const l=c instanceof Error?c.message:"Unknown error occurred";n({success:!1,clearedCount:0,error:l}),I.error(`âŒ Error clearing town wiki pages: ${l}`)}finally{s(!1)}}};return e.jsxs(N,{className:"w-full max-w-md",children:[e.jsxs(P,{children:[e.jsxs(A,{className:"flex items-center gap-2",children:[e.jsx(se,{className:"h-5 w-5 text-red-500"}),"Clear Town Wiki Pages"]}),e.jsx(z,{children:"Remove all content from town wiki pages. This action cannot be undone."})]}),e.jsxs(k,{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-start gap-3 p-3 bg-amber-50 border border-amber-200 rounded-lg",children:[e.jsx(Ae,{className:"h-5 w-5 text-amber-600 mt-0.5 flex-shrink-0"}),e.jsxs("div",{className:"text-sm text-amber-800",children:[e.jsx("p",{className:"font-medium",children:"Warning"}),e.jsx("p",{children:"This will permanently clear the content of all town wiki pages. The pages will remain but will have no content."})]})]}),e.jsx(b,{onClick:i,disabled:r,variant:"destructive",className:"w-full",children:r?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"}),"Clearing..."]}):e.jsxs(e.Fragment,{children:[e.jsx(se,{className:"h-4 w-4 mr-2"}),"Clear All Town Wiki Pages"]})}),t&&e.jsx("div",{className:`p-3 rounded-lg border ${t.success?"bg-green-50 border-green-200":"bg-red-50 border-red-200"}`,children:e.jsxs("div",{className:"flex items-center gap-2",children:[t.success?e.jsx(Z,{className:"h-5 w-5 text-green-600"}):e.jsx(ge,{className:"h-5 w-5 text-red-600"}),e.jsx("div",{className:"text-sm",children:t.success?e.jsxs("p",{className:"text-green-800",children:["Successfully cleared ",t.clearedCount," town wiki pages"]}):e.jsxs("p",{className:"text-red-800",children:["Failed to clear town wiki pages: ",t.error]})})]})})]})]})},ys=()=>{const{profile:r,loading:s,user:t,isAuthenticated:n}=Me(),{toast:i}=xe(),[c,l]=o.useState(!1),[g,j]=o.useState(!1),[m,x]=o.useState(()=>localStorage.getItem("aiKnowledge")||""),[h,p]=o.useState(!1),[w,v]=o.useState([]),[T,F]=o.useState(!1);o.useState(null);const[a,u]=o.useState({title:"",section:"Supabase Table",content:"",tags:[]}),y=async()=>{F(!0);try{const{data:d,error:_}=await f.from("ai_knowledgebase").select("*").order("section, title");if(_)throw _;v(d||[])}catch(d){console.error("Error loading knowledgebase:",d),i({title:"Error",description:"Failed to load knowledgebase entries",variant:"destructive"})}finally{F(!1)}},E=async()=>{if(!a.title||!a.content){i({title:"Error",description:"Title and content are required",variant:"destructive"});return}try{const{error:d}=await f.from("ai_knowledgebase").insert([{title:a.title,section:a.section,content:a.content,tags:a.tags}]);if(d)throw d;i({title:"Success!",description:"Knowledgebase entry added successfully"}),u({title:"",section:"Supabase Table",content:"",tags:[]}),y()}catch(d){console.error("Error saving knowledgebase entry:",d),i({title:"Error",description:"Failed to save knowledgebase entry",variant:"destructive"})}};o.useEffect(()=>{y()},[]);const D=()=>{p(!0),localStorage.setItem("aiKnowledge",m),setTimeout(()=>p(!1),500),i({title:"Saved!",description:"AI Knowledgebase updated. Thor the Bot will use this information."})};if(o.useEffect(()=>{},[t,r,s,n]),s)return e.jsx("div",{className:"flex items-center justify-center min-h-screen",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"})});if(!n||!t)return e.jsx(ce,{to:"/",replace:!0});if(!r)return e.jsx("div",{className:"flex items-center justify-center min-h-screen",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"})});if(r.role!=="admin")return e.jsx(ce,{to:"/",replace:!0});const W=async()=>{try{l(!0);const d=await is();d.success?i({title:"Success!",description:"Town achievements have been populated in the database."}):i({title:"Error",description:d.message||"Failed to populate town achievements",variant:"destructive"})}catch(d){console.error("Error populating town achievements:",d),i({title:"Error",description:"Failed to populate town achievements",variant:"destructive"})}finally{l(!1)}},C=async()=>{try{j(!0);const d=await ns();d.success?i({title:"Success!",description:"Town achievements have been synced for all towns."}):i({title:"Error",description:d.message||"Failed to sync town achievements",variant:"destructive"})}catch(d){console.error("Error syncing town achievements:",d),i({title:"Error",description:"Failed to sync town achievements",variant:"destructive"})}finally{j(!1)}};return e.jsxs("div",{className:"container mx-auto px-4 py-8",children:[e.jsxs("div",{className:"mb-8",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx(Ie,{className:"w-8 h-8 text-primary"}),e.jsx("h1",{className:"text-3xl font-bold",children:"Admin Panel"})]}),e.jsx("p",{className:"text-muted-foreground",children:"Manage server settings, players, and system functions."}),e.jsxs("p",{className:"text-sm text-muted-foreground mt-2",children:["Logged in as: ",r.email," (Role: ",r.role,")"]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:[e.jsx("div",{className:"md:col-span-2 lg:col-span-1",children:e.jsx(Qe,{})}),e.jsx("div",{className:"md:col-span-2 lg:col-span-2",children:e.jsx(Ye,{})}),e.jsx("div",{className:"md:col-span-2 lg:col-span-3",children:e.jsx(es,{})}),e.jsx("div",{className:"md:col-span-2 lg:col-span-3",children:e.jsx(ss,{})}),e.jsx("div",{className:"md:col-span-2 lg:col-span-3",children:e.jsx(ts,{})}),e.jsxs(N,{children:[e.jsx(P,{children:e.jsxs(A,{className:"flex items-center gap-2",children:[e.jsx(G,{className:"w-5 h-5"}),"Town Achievements"]})}),e.jsx(k,{children:e.jsxs("div",{className:"space-y-3",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Set up town achievement definitions and tiers in the database."}),e.jsx(b,{onClick:W,disabled:c,className:"w-full",children:c?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"}),"Populating..."]}):e.jsxs(e.Fragment,{children:[e.jsx(G,{className:"w-4 h-4 mr-2"}),"Populate Town Achievements"]})}),e.jsx(b,{onClick:C,disabled:g,variant:"outline",className:"w-full",children:g?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-primary mr-2"}),"Syncing..."]}):e.jsxs(e.Fragment,{children:[e.jsx(R,{className:"w-4 h-4 mr-2"}),"Sync All Town Achievements"]})})]})})]}),e.jsxs(N,{children:[e.jsx(P,{children:e.jsxs(A,{className:"flex items-center gap-2",children:[e.jsx(Fe,{className:"w-5 h-5"}),"Player Statistics"]})}),e.jsx(k,{children:e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"Total Players:"}),e.jsx("span",{className:"font-medium",children:"322+"})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"Online Now:"}),e.jsx("span",{className:"font-medium text-green-600",children:"Active"})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"Achievements:"}),e.jsx("span",{className:"font-medium",children:"Synced"})]})]})})]}),e.jsxs(N,{children:[e.jsx(P,{children:e.jsxs(A,{className:"flex items-center gap-2",children:[e.jsx(J,{className:"w-5 h-5"}),"System Status"]})}),e.jsx(k,{children:e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"Database:"}),e.jsx("span",{className:"font-medium text-green-600",children:"Connected"})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"Sync Status:"}),e.jsx("span",{className:"font-medium text-green-600",children:"Active"})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"Last Update:"}),e.jsx("span",{className:"font-medium",children:"Recently"})]})]})})]}),e.jsxs(N,{className:"md:col-span-2 lg:col-span-3",children:[e.jsx(P,{children:e.jsxs(A,{className:"flex items-center gap-2",children:[e.jsx(Q,{className:"w-5 h-5"}),"Quick Actions"]})}),e.jsx(k,{children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"p-4 border rounded-lg",children:[e.jsx("h3",{className:"font-semibold mb-2",children:"Player Management"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Manage player profiles, stats, and achievements"})]}),e.jsxs("div",{className:"p-4 border rounded-lg",children:[e.jsx("h3",{className:"font-semibold mb-2",children:"Server Settings"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Configure server parameters and maintenance"})]}),e.jsxs("div",{className:"p-4 border rounded-lg",children:[e.jsx("h3",{className:"font-semibold mb-2",children:"Data Sync"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Synchronize data between systems and databases"})]})]})})]}),e.jsxs(N,{className:"md:col-span-2 lg:col-span-3",children:[e.jsx(P,{children:e.jsxs(A,{className:"flex items-center gap-2",children:[e.jsx(ue,{className:"w-5 h-5"}),"AI Knowledgebase Management"]})}),e.jsx(k,{children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx(U,{htmlFor:"legacy-knowledge",children:"Legacy Knowledge (Local Storage)"}),e.jsx(oe,{id:"legacy-knowledge",value:m,onChange:d=>x(d.target.value),placeholder:"Type knowledge, rules, or FAQs here...",disabled:h,className:"min-h-[120px] font-mono"}),e.jsx(b,{onClick:D,disabled:h,className:"mt-2",children:h?"Saving...":"Save Legacy Knowledge"}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"This is the old localStorage method. Use the database entries below for better management."})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Database Knowledgebase Entries"}),e.jsx(b,{onClick:y,disabled:T,size:"sm",children:T?"Loading...":"Refresh"})]}),e.jsxs("div",{className:"border rounded-lg p-4 mb-4",children:[e.jsx("h4",{className:"font-medium mb-3",children:"Add New Entry"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(U,{htmlFor:"entry-title",children:"Title"}),e.jsx(V,{id:"entry-title",value:a.title,onChange:d=>u(_=>({..._,title:d.target.value})),placeholder:"e.g., towns, nations, achievements"})]}),e.jsxs("div",{children:[e.jsx(U,{htmlFor:"entry-section",children:"Section"}),e.jsxs(De,{value:a.section,onValueChange:d=>u(_=>({..._,section:d})),children:[e.jsx(We,{children:e.jsx($e,{})}),e.jsxs(Ue,{children:[e.jsx(Y,{value:"Supabase Table",children:"Supabase Table"}),e.jsx(Y,{value:"Storage",children:"Storage"}),e.jsx(Y,{value:"Instructions",children:"Instructions"})]})]})]})]}),e.jsxs("div",{className:"mt-4",children:[e.jsx(U,{htmlFor:"entry-content",children:"Content"}),e.jsx(oe,{id:"entry-content",value:a.content,onChange:d=>u(_=>({..._,content:d.target.value})),placeholder:"Describe what this table/section is for and how to use it...",className:"min-h-[100px]"})]}),e.jsxs("div",{className:"mt-4",children:[e.jsx(U,{htmlFor:"entry-tags",children:"Tags (comma-separated)"}),e.jsx(V,{id:"entry-tags",value:a.tags.join(", "),onChange:d=>u(_=>({..._,tags:d.target.value.split(",").map(M=>M.trim()).filter(M=>M)})),placeholder:"e.g., towns, balance, mayor"})]}),e.jsx(b,{onClick:E,className:"mt-4",children:"Add Entry"})]}),e.jsx("div",{className:"space-y-2",children:w.map(d=>e.jsx("div",{className:"border rounded-lg p-3",children:e.jsx("div",{className:"flex items-start justify-between",children:e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("span",{className:"font-medium",children:d.title}),e.jsx(S,{variant:"outline",className:"text-xs",children:d.section})]}),e.jsx("p",{className:"text-sm text-muted-foreground mb-2",children:d.content}),e.jsx("div",{className:"flex flex-wrap gap-1",children:d.tags.map((_,M)=>e.jsx(S,{variant:"secondary",className:"text-xs",children:_},M))})]})})},d.id))})]})]})})]}),e.jsx(N,{className:"md:col-span-2 lg:col-span-3",children:e.jsx(rs,{})}),e.jsx(N,{className:"md:col-span-2 lg:col-span-3",children:e.jsx(ls,{})}),e.jsx(N,{className:"md:col-span-2 lg:col-span-3",children:e.jsx(cs,{})})]})]})};export{ys as default};
