import{s as o}from"./index-BDwxLbfg.js";class d{static async getPlayerTownData(r){var e,a;try{const{data:n,error:t}=await o.from("residents").select("*").eq("name",r).single();if(t&&t.code!=="PGRST116")throw t;if(n)return{townName:n.town_name||"",nationName:n.nation_name||null,isMayor:n.is_mayor||!1,isKing:n.is_king||!1,isResident:!0};const{data:s,error:i}=await o.from("towns").select(`
          name,
          nations(name, leader_name)
        `).eq("mayor_name",r).single();if(i&&i.code!=="PGRST116")throw i;if(s){const l=((e=s.nations)==null?void 0:e.leader_name)===r;return{townName:s.name,nationName:((a=s.nations)==null?void 0:a.name)||null,isMayor:!0,isKing:l,isResident:!0}}const{data:c,error:m}=await o.from("nations").select("name, leader_name").eq("leader_name",r).single();if(m&&m.code!=="PGRST116")throw m;return c?{townName:"",nationName:c.name,isMayor:!1,isKing:!0,isResident:!0}:null}catch(n){return console.error("Error getting player town data:",n),null}}static async getPlayerNation(r){const e=await this.getPlayerTownData(r);return(e==null?void 0:e.nationName)||null}static async getUserNationForums(r){try{const e=await this.getPlayerTownData(r);if(!(e!=null&&e.nationName))return null;const{data:a,error:n}=await o.from("towns").select("name, mayor_name").eq("nation_name",e.nationName);if(n)throw n;return{nationName:e.nationName,towns:(a==null?void 0:a.map(t=>({name:t.name,isUserMayor:t.mayor_name===r})))||[]}}catch(e){return console.error("Error getting user nation forums:",e),null}}static async canAccessNationForum(r,e){const a=await this.getPlayerTownData(r);return(a==null?void 0:a.nationName)===e}static async canAccessTownForum(r,e,a){try{const{data:n,error:t}=await o.from("residents").select("nation_name").eq("name",r).eq("town_name",a).single();if(t&&t.code!=="PGRST116")throw t;if(n)return n.nation_name===e;const{data:s,error:i}=await o.from("towns").select("id").eq("mayor_name",r).eq("name",a).eq("nation_name",e).single();if(i&&i.code!=="PGRST116")throw i;return!!s}catch(n){return console.error("Error checking town forum access:",n),!1}}static async getNationMayors(r){try{const{data:e,error:a}=await o.from("towns").select("mayor_name").eq("nation_name",r);if(a)throw a;return(e==null?void 0:e.map(n=>n.mayor_name).filter(Boolean))||[]}catch(e){return console.error("Error getting nation mayors:",e),[]}}static async getNationKings(){try{const{data:r,error:e}=await o.from("nations").select("name, leader_name").not("leader_name","is",null);if(e)throw e;return(r==null?void 0:r.map(a=>({nationName:a.name,leader:a.leader_name})))||[]}catch(r){return console.error("Error getting nation kings:",r),[]}}static formatNationName(r){return r.replace(/_/g," ")}}export{d as P};
