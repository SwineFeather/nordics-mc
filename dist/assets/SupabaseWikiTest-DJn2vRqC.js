import{I as re,bM as ae,r as x,j as e,bT as oe,w as o,x as l,y as i,z as n,v as h,b5 as le,aI as ie,b4 as U,B as W,s as d,aF as c}from"./index-BDwxLbfg.js";import{B as H}from"./bug-DtzzRC27.js";import{L as T}from"./loader-circle-BQXbm3ye.js";import{F as ne}from"./folder-open-CXUkkFsL.js";import{R as ce}from"./refresh-cw-CWYIYyYX.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const de=re("Cloud",[["path",{d:"M17.5 19H9a7 7 0 1 1 6.71-9h1.79a4.5 4.5 0 1 1 0 9Z",key:"p7xjir"}]]),fe=()=>{const{categories:g,fileStructure:N,loading:w,error:u,lastUpdated:S,refreshData:C,getPageByPath:z,searchPages:J,getFileContent:O}=ae(),[E,D]=x.useState(!1),[b,_]=x.useState([]),[v,Z]=x.useState("Nordics/towns/garvia/README.md"),[P,R]=x.useState(null),[F,L]=x.useState(!1),q=async()=>{L(!0);try{console.log("🔍 Starting storage debug..."),console.log("📁 Testing directory listing approach...");const{data:s,error:m}=await d.storage.from("wiki").list("",{limit:100}),{data:f,error:A}=await d.storage.from("wiki").list("Nordics",{limit:100}),{data:j,error:I}=await d.storage.from("wiki").list("",{limit:1e3});console.log("📁 Directory listing results:"),console.log("  Root files:",(s==null?void 0:s.length)||0,"Error:",m),console.log("  Nordics files:",(f==null?void 0:f.length)||0,"Error:",A),console.log("  All files:",(j==null?void 0:j.length)||0,"Error:",I),console.log("🔍 Testing new path discovery approach...");const V=["Nordics/nations/constellation.md","Nordics/towns/garvia/README.md","Nordics/towns/garvia/","Nordics/towns/","Nordics/nations/","Nordics/"],p={};for(const t of V)try{if(console.log(`🔍 Testing path: ${t}`),t.endsWith(".md")){const{data:r,error:a}=await d.storage.from("wiki").download(t);p[t]={type:"file",found:!a&&r,error:a,size:r?r.size:null}}else{const{data:r,error:a}=await d.storage.from("wiki").list(t,{limit:100});p[t]={type:"directory",found:!a&&r&&r.length>0,error:a,itemCount:r?r.length:0,items:r?r.map(B=>({name:B.name,type:B.metadata?"file":"folder"})):[]}}}catch(r){p[t]={type:"error",found:!1,error:r.message}}console.log("🔍 Testing direct file access...");const{data:X,error:Y}=await d.storage.from("wiki").download("Nordics/nations/constellation.md"),{data:M}=d.storage.from("wiki").getPublicUrl("Nordics/nations/constellation.md");let y=null;try{const t=await fetch(M.publicUrl);y={status:t.status,ok:t.ok,statusText:t.statusText}}catch(t){y={error:t.message}}const ee=["Nordics","nordics","Nordics/","nordics/","the-world","The-World"],$={};for(const t of ee){const{data:r,error:a}=await d.storage.from("wiki").list(t,{limit:10});$[t]={data:r,error:a}}console.log("🔍 Testing HTTP discovery...");const k={},se="https://erdconvorgecupvavlwv.supabase.co/storage/v1/object/public/wiki",te=["Nordics/towns/sogndalsfjorden.md","Nordics/towns/kingdom_of_albion/england/lundenwic.md","Nordics/towns/northstar/README.md","Nordics/server-events/terrain-incidents/northstar-forest-fire.md","Nordics/server-events/terrain-incidents/the-sapmi-forest-fire.md","Nordics/towns/README.md","Nordics/nations/README.md","Nordics/README.md","Nordics/towns/garvia/history.md","Nordics/towns/garvia/economy.md","Nordics/towns/garvia/culture.md","Nordics/towns/garvia/government.md"];for(const t of te)try{const r=`${se}/${t}`;console.log(`🌐 Testing HTTP: ${r}`);const a=await fetch(r);k[t]={status:a.status,ok:a.ok,found:a.ok,url:r},a.ok&&console.log(`✅ Found via HTTP: ${t}`)}catch(r){k[t]={error:r.message,found:!1}}console.log("🔍 Testing wiki structure...");try{await C(),console.log("✅ Wiki structure refreshed successfully")}catch(t){console.log("❌ Wiki structure refresh failed:",t)}R({rootFiles:s,nordicsFiles:f,allFiles:j,testFile:X?"File found":"File not found",testError:Y,publicUrl:M,httpResponse:y,pathTests:$,errors:{root:m,nordics:A,all:I},discoveryResults:p,httpDiscoveryResults:k}),c.success("Storage debug completed")}catch(s){console.error("Debug failed:",s),R({error:"Debug failed",details:s}),c.error("Debug failed")}finally{L(!1)}},G=async()=>{D(!0);try{const s=await J("garvia");_(s),c.success(`Found ${s.length} pages matching 'garvia'`)}catch(s){console.error("Search test failed:",s),c.error("Search test failed")}finally{D(!1)}},K=async()=>{try{const s=await z(v);s?(c.success(`Successfully loaded page: ${s.title}`),console.log("Loaded page:",s)):c.error("Page not found")}catch(s){console.error("Page load test failed:",s),c.error("Page load test failed")}},Q=async()=>{try{const s=await O(v);c.success(`Successfully loaded file content (${s.length} characters)`),console.log("File content preview:",s.substring(0,200)+"...")}catch(s){console.error("File content test failed:",s),c.error("File content test failed")}};return e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-6",children:[e.jsx(oe,{className:"h-6 w-6 text-blue-500"}),e.jsx("h1",{className:"text-2xl font-bold",children:"Supabase Storage Wiki Test"})]}),e.jsxs(o,{children:[e.jsx(l,{children:e.jsxs(i,{className:"text-sm flex items-center gap-2",children:[e.jsx(H,{className:"h-4 w-4"}),"Debug Storage Access"]})}),e.jsx(n,{children:e.jsxs(h,{onClick:q,disabled:F,children:[F?e.jsx(T,{className:"h-4 w-4 mr-2 animate-spin"}):e.jsx(H,{className:"h-4 w-4 mr-2"}),"Debug Storage"]})})]}),P&&e.jsxs(o,{children:[e.jsx(l,{children:e.jsx(i,{className:"text-sm",children:"Debug Information"})}),e.jsx(n,{children:e.jsx("pre",{className:"text-xs bg-muted p-2 rounded overflow-auto max-h-60",children:JSON.stringify(P,null,2)})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs(o,{children:[e.jsx(l,{className:"pb-2",children:e.jsxs(i,{className:"text-sm flex items-center gap-2",children:[e.jsx(de,{className:"h-4 w-4"}),"Connection Status"]})}),e.jsx(n,{children:e.jsxs("div",{className:"flex items-center gap-2",children:[w?e.jsx(T,{className:"h-4 w-4 animate-spin"}):u?e.jsx(le,{className:"h-4 w-4 text-red-500"}):e.jsx(ie,{className:"h-4 w-4 text-green-500"}),e.jsx("span",{className:"text-sm",children:w?"Loading...":u?"Error":"Connected"})]})})]}),e.jsxs(o,{children:[e.jsx(l,{className:"pb-2",children:e.jsxs(i,{className:"text-sm flex items-center gap-2",children:[e.jsx(ne,{className:"h-4 w-4"}),"Categories"]})}),e.jsxs(n,{children:[e.jsx("div",{className:"text-2xl font-bold",children:g.length}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Total categories"})]})]}),e.jsxs(o,{children:[e.jsx(l,{className:"pb-2",children:e.jsxs(i,{className:"text-sm flex items-center gap-2",children:[e.jsx(U,{className:"h-4 w-4"}),"File Structure"]})}),e.jsxs(n,{children:[e.jsx("div",{className:"text-2xl font-bold",children:N.length}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Root items"})]})]})]}),u&&e.jsxs(o,{className:"border-red-200 bg-red-50 dark:bg-red-950 dark:border-red-800",children:[e.jsx(l,{children:e.jsx(i,{className:"text-red-700 dark:text-red-300",children:"Error"})}),e.jsx(n,{children:e.jsx("p",{className:"text-red-600 dark:text-red-400",children:u})})]}),S&&e.jsxs(o,{children:[e.jsx(l,{children:e.jsx(i,{className:"text-sm",children:"Last Updated"})}),e.jsx(n,{children:e.jsx("p",{className:"text-sm text-muted-foreground",children:S.toLocaleString()})})]}),e.jsxs(o,{children:[e.jsx(l,{children:e.jsx(i,{className:"text-sm",children:"Test Controls"})}),e.jsxs(n,{className:"space-y-4",children:[e.jsxs("div",{className:"flex gap-2 flex-wrap",children:[e.jsxs(h,{onClick:C,disabled:w,children:[e.jsx(ce,{className:"h-4 w-4 mr-2"}),"Refresh Data"]}),e.jsxs(h,{onClick:G,disabled:E,children:[E?e.jsx(T,{className:"h-4 w-4 mr-2 animate-spin"}):e.jsx(U,{className:"h-4 w-4 mr-2"}),"Test Search"]}),e.jsx(h,{onClick:K,variant:"outline",children:"Load Page"}),e.jsx(h,{onClick:Q,variant:"outline",children:"Load Content"}),e.jsx(h,{onClick:()=>{console.log("🔍 Testing wiki service directly..."),console.log("Categories:",g),console.log("File structure:",N)},variant:"outline",children:"Log Service Data"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"Test Path:"}),e.jsx("input",{type:"text",value:v,onChange:s=>Z(s.target.value),className:"w-full p-2 border rounded text-sm",placeholder:"Enter file path to test..."})]})]})]}),e.jsxs(o,{children:[e.jsx(l,{children:e.jsxs(i,{className:"text-sm",children:["Categories (",g.length,")"]})}),e.jsx(n,{children:e.jsx("div",{className:"space-y-2",children:g.map(s=>{var m;return e.jsxs("div",{className:"flex items-center justify-between p-2 border rounded",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium",children:s.title}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:[((m=s.pages)==null?void 0:m.length)||0," pages"]})]}),e.jsx(W,{variant:"secondary",children:s.slug})]},s.id)})})})]}),b.length>0&&e.jsxs(o,{children:[e.jsx(l,{children:e.jsxs(i,{className:"text-sm",children:["Search Results (",b.length,")"]})}),e.jsx(n,{children:e.jsx("div",{className:"space-y-2",children:b.map(s=>e.jsxs("div",{className:"flex items-center justify-between p-2 border rounded",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium",children:s.title}),e.jsx("p",{className:"text-sm text-muted-foreground",children:s.category})]}),e.jsx(W,{variant:"outline",children:s.slug})]},s.id))})})]}),e.jsxs(o,{children:[e.jsx(l,{children:e.jsx(i,{className:"text-sm",children:"File Structure Preview"})}),e.jsx(n,{children:e.jsx("pre",{className:"text-xs bg-muted p-2 rounded overflow-auto max-h-40",children:JSON.stringify(N,null,2)})})]})]})};export{fe as default};
