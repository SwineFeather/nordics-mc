import{I as x,ca as h,r as n,u as f,j as e,w as g,x as j,y as N,bU as v,z as y,bd as I,b5 as b,be as k,v as w}from"./index-BDwxLbfg.js";import{L as C}from"./loader-circle-BQXbm3ye.js";import{A as S}from"./arrow-left-BpGtw6K8.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const J=x("CircleCheck",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]]),_=h("https://erdconvorgecupvavlwv.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImVyZGNvbnZvcmdlY3VwdmF2bHd2Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDk1ODM4ODcsImV4cCI6MjA2NTE1OTg4N30.1JAp47oJDpiNmnKjpYB_tS9__0Sytk18o8dL-Dfnrdg"),E=()=>{const[o,i]=n.useState(null),[d,a]=n.useState(!0),[m,u]=n.useState(!1),c=f();n.useEffect(()=>{const l=new URLSearchParams(window.location.search).get("token");if(!l){i("No token provided."),a(!1);return}(async()=>{try{a(!0);const t=await fetch(`https://erdconvorgecupvavlwv.supabase.co/functions/v1/validate-token?token=${l}&create_session=true`,{headers:{Authorization:"Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImVyZGNvbnZvcmdlY3VwdmF2bHd2Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDk1ODM4ODcsImV4cCI6MjA2NTE1OTg4N30.1JAp47oJDpiNmnKjpYB_tS9__0Sytk18o8dL-Dfnrdg","Content-Type":"application/json"}});if(!t.ok)throw new Error(`HTTP error! status: ${t.status}`);const s=await t.json();if(!s.valid){i(s.error||"Invalid or expired token."),a(!1);return}if(localStorage.setItem("player_uuid",s.player_uuid),localStorage.setItem("player_name",s.player_name),s.profile_id&&localStorage.setItem("tokenlink_profile_id",s.profile_id),s.profile&&localStorage.setItem("profile",JSON.stringify(s.profile)),s.session&&s.session.access_token){console.log("Attempting to establish Supabase session");try{const{error:r}=await _.auth.signInWithOtp({email:s.profile.email,options:{shouldCreateUser:!1}});r?console.warn("Failed to create Supabase session:",r):console.log("Supabase session established successfully")}catch(r){console.warn("Session creation error:",r)}}u(!0),setTimeout(()=>{c("/dashboard")},2e3)}catch(t){console.error("Login error:",t),i("Failed to validate token. Please try again."),a(!1)}})()},[c]);const p=()=>{window.location.href="/"};return e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-slate-900 via-slate-800 to-slate-900 dark:from-slate-900 dark:via-slate-800 dark:to-slate-900 bg-background flex items-center justify-center p-4",children:e.jsxs(g,{className:"w-full max-w-md",children:[e.jsxs(j,{className:"text-center",children:[e.jsx(N,{className:"text-2xl font-bold",children:"TokenLink Login"}),e.jsx(v,{children:"Authenticating your Minecraft account..."})]}),e.jsxs(y,{children:[d&&e.jsxs("div",{className:"text-center space-y-4",children:[e.jsx("div",{className:"flex justify-center",children:e.jsx(C,{className:"h-12 w-12 animate-spin text-blue-500"})}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("p",{className:"font-medium",children:"Validating login token..."}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Creating your session and syncing your profile"})]})]}),m&&e.jsxs("div",{className:"text-center space-y-4",children:[e.jsx("div",{className:"flex justify-center",children:e.jsx(J,{className:"h-12 w-12 text-green-500"})}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("p",{className:"font-medium text-green-600 dark:text-green-400",children:"Login successful!"}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Welcome, ",localStorage.getItem("player_name"),"!"]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Your profile has been synced and you now have full website access."}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Redirecting to your dashboard..."})]})]}),o&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs(I,{variant:"destructive",children:[e.jsx(b,{className:"h-4 w-4"}),e.jsx(k,{className:"text-sm",children:o})]}),e.jsxs("div",{className:"text-center space-y-3",children:[e.jsxs("div",{className:"p-4 bg-muted rounded-lg",children:[e.jsx("p",{className:"text-sm font-medium mb-2",children:"To get a new login link:"}),e.jsxs("ol",{className:"text-sm text-muted-foreground text-left space-y-1",children:[e.jsx("li",{children:"1. Join the Minecraft server"}),e.jsxs("li",{children:["2. Type ",e.jsx("code",{className:"bg-background px-1 rounded",children:"/login"})," in chat"]}),e.jsx("li",{children:"3. Click the link provided"})]})]}),e.jsxs(w,{onClick:p,variant:"outline",className:"w-full",children:[e.jsx(S,{className:"w-4 h-4 mr-2"}),"Return to Homepage"]}),e.jsxs("div",{className:"text-center text-sm text-muted-foreground",children:["Don't have a Minecraft account?"," ",e.jsx("a",{href:"/signup",className:"text-blue-500 hover:text-blue-400 font-medium underline",children:"Create a website account"})]})]})]})]})]})})};export{E as default};
