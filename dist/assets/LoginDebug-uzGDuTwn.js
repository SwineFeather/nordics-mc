import{r as n,u as h,j as e,w as x,x as p,y as f,bU as j,z as v,bd as k,b5 as b,be as N,v as c}from"./index-BDwxLbfg.js";import{B as w}from"./bug-DtzzRC27.js";import{L as y}from"./loader-circle-BQXbm3ye.js";import{A as S}from"./arrow-left-BpGtw6K8.js";const C=()=>{const[t,r]=n.useState({hasToken:!1,tokenValue:null,localStorageData:{},error:null,functionResponse:null}),[d,i]=n.useState(!1);h(),n.useEffect(()=>{const s=new URLSearchParams(window.location.search).get("token"),a={player_uuid:localStorage.getItem("player_uuid"),player_name:localStorage.getItem("player_name"),tokenlink_profile_id:localStorage.getItem("tokenlink_profile_id"),profile:localStorage.getItem("profile"),supabase_auth_token:localStorage.getItem("supabase.auth.token")};r({hasToken:!!s,tokenValue:s,localStorageData:a,error:null,functionResponse:null}),s&&m(s)},[]);const m=async o=>{i(!0);try{console.log("Testing token validation with:",o);const s=await fetch(`https://erdconvorgecupvavlwv.supabase.co/functions/v1/validate-token?token=${o}&create_session=true`);console.log("Response status:",s.status),console.log("Response headers:",Object.fromEntries(s.headers.entries()));const a=await s.json();if(console.log("Response data:",a),r(l=>({...l,functionResponse:a})),!s.ok)throw new Error(`HTTP error! status: ${s.status}`);a.valid||r(l=>({...l,error:a.error||"Invalid or expired token."}))}catch(s){console.error("Token validation error:",s),r(a=>({...a,error:s instanceof Error?s.message:"Unknown error occurred"}))}finally{i(!1)}},u=()=>{window.location.href="/"},g=()=>{localStorage.removeItem("player_uuid"),localStorage.removeItem("player_name"),localStorage.removeItem("tokenlink_profile_id"),localStorage.removeItem("profile"),localStorage.removeItem("supabase.auth.token"),Object.keys(localStorage).forEach(o=>{(o.startsWith("supabase.auth.")||o.includes("sb-"))&&localStorage.removeItem(o)}),window.location.reload()};return e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-slate-900 via-slate-800 to-slate-900 dark:from-slate-900 dark:via-slate-800 dark:to-slate-900 bg-background flex items-center justify-center p-4",children:e.jsxs(x,{className:"w-full max-w-4xl",children:[e.jsxs(p,{className:"text-center",children:[e.jsxs(f,{className:"text-2xl font-bold flex items-center justify-center gap-2",children:[e.jsx(w,{className:"h-6 w-6"}),"Login Debug Information"]}),e.jsx(j,{children:"Debug information for login troubleshooting"})]}),e.jsxs(v,{className:"space-y-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("h3",{className:"font-semibold",children:"URL Parameters:"}),e.jsxs("div",{className:"bg-muted p-3 rounded-lg",children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Has Token:"})," ",t.hasToken?"Yes":"No"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Token Value:"})," ",t.tokenValue||"None"]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("h3",{className:"font-semibold",children:"LocalStorage Data:"}),e.jsx("div",{className:"bg-muted p-3 rounded-lg",children:e.jsx("pre",{className:"text-sm overflow-auto",children:JSON.stringify(t.localStorageData,null,2)})})]}),t.functionResponse&&e.jsxs("div",{className:"space-y-2",children:[e.jsx("h3",{className:"font-semibold",children:"Function Response:"}),e.jsx("div",{className:"bg-muted p-3 rounded-lg",children:e.jsx("pre",{className:"text-sm overflow-auto",children:JSON.stringify(t.functionResponse,null,2)})})]}),t.error&&e.jsxs(k,{variant:"destructive",children:[e.jsx(b,{className:"h-4 w-4"}),e.jsx(N,{className:"text-sm",children:t.error})]}),d&&e.jsxs("div",{className:"text-center space-y-4",children:[e.jsx("div",{className:"flex justify-center",children:e.jsx(y,{className:"h-12 w-12 animate-spin text-blue-500"})}),e.jsx("p",{className:"font-medium",children:"Testing token validation..."})]}),e.jsxs("div",{className:"flex gap-3 justify-center",children:[e.jsxs(c,{onClick:u,variant:"outline",children:[e.jsx(S,{className:"w-4 h-4 mr-2"}),"Return to Homepage"]}),e.jsx(c,{onClick:g,variant:"destructive",children:"Clear LocalStorage"})]}),e.jsx("div",{className:"text-center space-y-3",children:e.jsxs("div",{className:"p-4 bg-muted rounded-lg",children:[e.jsx("p",{className:"text-sm font-medium mb-2",children:"To test login:"}),e.jsxs("ol",{className:"text-sm text-muted-foreground text-left space-y-1",children:[e.jsx("li",{children:"1. Join the Minecraft server"}),e.jsxs("li",{children:["2. Type ",e.jsx("code",{className:"bg-background px-1 rounded",children:"/login"})," in chat"]}),e.jsx("li",{children:"3. Click the link provided"}),e.jsx("li",{children:"4. Check this debug page for information"})]})]})})]})]})})};export{C as default};
