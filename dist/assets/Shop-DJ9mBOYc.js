import{I as re,ba as ie,u as ne,ay as le,ax as ce,r as n,s as x,j as e,v as i,B as j,a8 as oe,a5 as de,a4 as me,w as c,z as o,ae as xe,aG as he,x as _,y as k,aT as pe,b4 as ue,aH as je,Y as fe,Z as Ne,$ as ye,a0 as ge,a1 as ve,a2 as we,aJ as be,az as Se,aF as l}from"./index-BDwxLbfg.js";import{u as Ce}from"./useShopsData-DSSRsv2y.js";import{M as _e,g as E,a as U,d as ke,h as O,e as Ee,b as Fe,c as De}from"./MinecraftItemImage-B08oUpod.js";import{S as ze}from"./ShopMapEmbed-H36lczdu.js";import{S as R}from"./SimpleMarkdownRenderer-48bOWxLE.js";import{A as H}from"./arrow-left-BpGtw6K8.js";import{C as Ie}from"./coins-C6lwFDE4.js";import{P as $}from"./package-DIOTFOqO.js";import{P as Pe}from"./pen-line-DhrBiHG4.js";import{S as Te}from"./save-CBFCkKxY.js";import{B as F}from"./building-nraDPmQ5.js";import"./external-link-DMGOVlse.js";import"./loader-circle-BQXbm3ye.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Me=re("Share2",[["circle",{cx:"18",cy:"5",r:"3",key:"gq8acd"}],["circle",{cx:"6",cy:"12",r:"3",key:"w7nqdw"}],["circle",{cx:"18",cy:"19",r:"3",key:"1xt0gg"}],["line",{x1:"8.59",x2:"15.42",y1:"13.51",y2:"17.49",key:"47mynk"}],["line",{x1:"15.41",x2:"8.59",y1:"6.51",y2:"10.49",key:"1n3mei"}]]),We=()=>{const{shopId:f}=ie(),D=ne(),{user:N,profile:r}=le(),{shops:y,loading:Y,error:z}=Ce(),{companies:d,loading:G}=ce(),[s,g]=n.useState(null),[I,v]=n.useState(!1),[m,w]=n.useState(""),[P,T]=n.useState(!1),[h,b]=n.useState(!1),[p,M]=n.useState(""),[A,B]=n.useState(!1),[S,L]=n.useState(null);n.useEffect(()=>{if(f&&y.length>0){const a=y.find(t=>t.id===f);a&&(g(a),w(a.description||""))}},[f,y]),n.useEffect(()=>{s&&d.length>0&&q()},[s,d]);const J=()=>{navigator.clipboard.writeText(window.location.href),l.success("Shop link copied to clipboard!")},V=()=>{l.success("Shop added to favorites!")},W=()=>{navigator.share?navigator.share({title:`Shop: ${E((s==null?void 0:s.item_type)||"",s==null?void 0:s.item_display_name)}`,text:"Check out this shop on Nordics World!",url:window.location.href}):J()},C=()=>!s||!N?!1:s.owner_uuid===N.id||(r==null?void 0:r.role)==="admin"||(r==null?void 0:r.role)==="moderator",Z=()=>N?(r==null?void 0:r.role)==="admin"||(r==null?void 0:r.role)==="moderator":!1,X=()=>{v(!0)},K=async()=>{if(s)try{T(!0);const{error:a}=await x.from("shops").update({description:m.trim()||null}).eq("id",s.id);if(a)throw console.error("Database error:",a),new Error("Failed to save to database");g(t=>t?{...t,description:m.trim()||null}:null),v(!1),b(!1),l.success("Shop description updated successfully!")}catch(a){console.error("Error updating shop description:",a),l.error("Failed to update shop description")}finally{T(!1)}},Q=()=>{w((s==null?void 0:s.description)||""),v(!1),b(!1)},ee=async()=>{if(s)try{const a=!s.is_featured,{error:t}=await x.from("shops").update({is_featured:a}).eq("id",s.id);if(t)throw console.error("Database error:",t),new Error("Failed to update featured status");g(u=>u?{...u,is_featured:a}:null),l.success(a?"Shop featured successfully!":"Shop unfeatured successfully!")}catch(a){console.error("Error updating featured status:",a),l.error("Failed to update featured status")}},q=async()=>{if(s!=null&&s.id)try{const{data:a,error:t}=await x.from("shops").select("company_id").eq("id",s.id).single();if(t&&t.code!=="PGRST116"){console.error("Error fetching shop company:",t);return}if(a!=null&&a.company_id){const u=d.find(te=>te.id===a.company_id);L(u||null)}}catch(a){console.error("Error fetching shop company:",a)}},se=async()=>{if(!(!(s!=null&&s.id)||!p)){B(!0);try{const{error:a}=await x.from("shops").update({company_id:p}).eq("id",s.id);if(a)throw a;l.success("Shop added to company successfully!"),M(""),q()}catch(a){console.error("Error adding shop to company:",a),l.error("Failed to add shop to company")}finally{B(!1)}}},ae=async()=>{if(s!=null&&s.id)try{const{error:a}=await x.from("shops").update({company_id:null}).eq("id",s.id);if(a)throw a;l.success("Shop removed from company successfully!"),L(null)}catch(a){console.error("Error removing shop from company:",a),l.error("Failed to remove shop from company")}};return Y?e.jsx("div",{className:"container mx-auto px-4 py-8",children:e.jsx("div",{className:"flex items-center justify-center min-h-[400px]",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary mx-auto mb-4"}),e.jsx("p",{className:"text-muted-foreground",children:"Loading shop data..."})]})})}):z||!s?e.jsx("div",{className:"container mx-auto px-4 py-8",children:e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"text-4xl mb-4",children:"⚠️"}),e.jsx("h3",{className:"text-xl font-bold mb-2",children:"Shop Not Found"}),e.jsx("p",{className:"text-muted-foreground mb-4",children:z||"The shop you are looking for does not exist or has been removed."}),e.jsxs(i,{onClick:()=>D("/towns"),variant:"outline",children:[e.jsx(H,{className:"w-4 h-4 mr-2"}),"Back to Marketplace"]})]})}):e.jsxs("div",{className:"container mx-auto px-4 py-8",children:[e.jsxs("div",{className:"mb-6",children:[e.jsxs(i,{onClick:()=>D("/towns"),variant:"ghost",className:"mb-4",children:[e.jsx(H,{className:"w-4 h-4 mr-2"}),"Back to Marketplace"]}),e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(_e,{itemType:s.item_type,size:"2xl"}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold mb-2",children:E(s.item_type,s.item_display_name)}),e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsxs(j,{className:`${U(s.type)} text-white`,children:[s.type==="buy"?"📥":"📤"," ",s.type.toUpperCase()]}),e.jsx(j,{variant:"outline",children:ke(s.world)})]}),e.jsxs("p",{className:"text-muted-foreground",children:["Owned by ",s.owner_uuid," • Last updated ",O(s.last_updated)]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(i,{onClick:V,variant:"outline",size:"sm",children:[e.jsx(oe,{className:"w-4 h-4 mr-2"}),"Favorite"]}),e.jsxs(i,{variant:"outline",size:"sm",children:[e.jsx(de,{className:"w-4 h-4 mr-2"}),"Contact Owner"]}),e.jsxs(i,{onClick:W,variant:"outline",size:"sm",children:[e.jsx(Me,{className:"w-4 h-4 mr-2"}),"Share"]}),Z()&&e.jsxs(i,{onClick:ee,variant:s.is_featured?"default":"outline",size:"sm",className:s.is_featured?"bg-gradient-to-r from-yellow-500 to-orange-500 text-white":"",children:[e.jsx(me,{className:"w-4 h-4 mr-2"}),s.is_featured?"Featured":"Feature"]})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"lg:col-span-2 space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsx(c,{children:e.jsx(o,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Ie,{className:"w-6 h-6 text-primary"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Price"}),e.jsx("p",{className:"text-xl font-bold",children:Ee(s.price)})]})]})})}),e.jsx(c,{children:e.jsx(o,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx($,{className:"w-6 h-6 text-primary"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Stock"}),e.jsx("p",{className:`text-xl font-bold ${Fe(s.stock,s.unlimited)}`,children:De(s.stock,s.unlimited)})]})]})})}),e.jsx(c,{children:e.jsx(o,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(xe,{className:"w-6 h-6 text-primary"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Amount"}),e.jsx("p",{className:"text-xl font-bold",children:s.item_amount})]})]})})}),e.jsx(c,{children:e.jsx(o,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(he,{className:"w-6 h-6 text-primary"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Updated"}),e.jsx("p",{className:"text-sm font-bold",children:O(s.last_updated)})]})]})})})]}),e.jsxs(c,{children:[e.jsx(_,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(k,{className:"flex items-center gap-2",children:[e.jsx(pe,{className:"w-5 h-5"}),"Shop Description"]}),C()&&!I&&e.jsxs(i,{variant:"outline",size:"sm",onClick:X,children:[e.jsx(Pe,{className:"w-4 h-4 mr-2"}),"Edit"]})]})}),e.jsx(o,{children:I?e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(i,{variant:h?"default":"outline",size:"sm",onClick:()=>b(!h),children:h?e.jsxs(e.Fragment,{children:[e.jsx(ue,{className:"w-4 h-4 mr-2"}),"Edit"]}):e.jsxs(e.Fragment,{children:[e.jsx(je,{className:"w-4 h-4 mr-2"}),"Preview"]})}),e.jsx("span",{className:"text-xs text-muted-foreground",children:"Supports Markdown formatting"})]}),h?e.jsx("div",{className:"min-h-[100px] p-3 border rounded-md bg-muted/20",children:m?e.jsx(R,{content:m}):e.jsx("p",{className:"text-muted-foreground italic",children:"No content to preview"})}):e.jsx("textarea",{value:m,onChange:a=>w(a.target.value),placeholder:"Describe your shop, what you sell, special offers, or any other information...\n\nYou can use Markdown formatting:\n**Bold text** *Italic text*\n# Headers\n- Lists\n- More items\n> Blockquotes\n`code` and ```code blocks```",className:"w-full min-h-[100px] p-3 border rounded-md resize-none focus:outline-none focus:ring-2 focus:ring-primary font-mono text-sm"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(i,{onClick:K,disabled:P,size:"sm",children:P?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"}),"Saving..."]}):e.jsxs(e.Fragment,{children:[e.jsx(Te,{className:"w-4 h-4 mr-2"}),"Save"]})}),e.jsxs(i,{variant:"outline",size:"sm",onClick:Q,children:[e.jsx(fe,{className:"w-4 h-4 mr-2"}),"Cancel"]})]})]}):e.jsx("div",{className:"min-h-[100px]",children:s!=null&&s.description?e.jsx(R,{content:s.description}):e.jsx("p",{className:"text-muted-foreground italic",children:C()?"No description yet. Click 'Edit' to add a description for your shop.":"No description available for this shop."})})})]}),C()&&e.jsxs(c,{children:[e.jsx(_,{children:e.jsxs(k,{className:"flex items-center gap-2",children:[e.jsx(F,{className:"w-5 h-5"}),"Company Management"]})}),e.jsx(o,{className:"space-y-4",children:S?e.jsx("div",{className:"space-y-3",children:e.jsxs("div",{className:"flex items-center justify-between p-3 bg-muted/50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(F,{className:"w-5 h-5 text-primary"}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold",children:S.name}),e.jsx("p",{className:"text-sm text-muted-foreground",children:S.tagline})]})]}),e.jsx(i,{variant:"outline",size:"sm",onClick:ae,children:"Remove from Company"})]})}):e.jsxs("div",{className:"space-y-3",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Add this shop to a company to manage it as part of a larger business."}),e.jsxs("div",{className:"flex gap-3",children:[e.jsxs(Ne,{value:p,onValueChange:M,children:[e.jsx(ye,{className:"flex-1",children:e.jsx(ge,{placeholder:"Select a company..."})}),e.jsx(ve,{children:d.map(a=>e.jsx(we,{value:a.id,children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(F,{className:"w-4 h-4"}),a.name]})},a.id))})]}),e.jsx(i,{onClick:se,disabled:!p||A,size:"sm",children:A?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"}),"Adding..."]}):e.jsxs(e.Fragment,{children:[e.jsx(be,{className:"w-4 h-4 mr-2"}),"Add to Company"]})})]}),d.length===0&&!G&&e.jsx("p",{className:"text-sm text-muted-foreground",children:"No companies available. Create a company first to add this shop."})]})})]}),e.jsxs(c,{children:[e.jsx(_,{children:e.jsxs(k,{className:"flex items-center gap-2",children:[e.jsx($,{className:"w-5 h-5"}),"Item Information"]})}),e.jsxs(o,{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold mb-2",children:"Basic Information"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"Item Type:"}),e.jsx("span",{className:"font-medium",children:s.item_type})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"Display Name:"}),e.jsx("span",{className:"font-medium",children:s.item_display_name||"Default"})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"Amount:"}),e.jsx("span",{className:"font-medium",children:s.item_amount})]}),s.item_durability>0&&e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"Durability:"}),e.jsx("span",{className:"font-medium",children:s.item_durability})]}),s.item_custom_model_data&&e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"Custom Model:"}),e.jsxs("span",{className:"font-medium text-purple-600",children:["#",s.item_custom_model_data]})]})]})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold mb-2",children:"Properties"}),e.jsxs("div",{className:"space-y-2",children:[s.item_unbreakable&&e.jsxs("div",{className:"flex items-center gap-2 text-green-600",children:[e.jsx(Se,{className:"w-4 h-4"}),e.jsx("span",{children:"Unbreakable"})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"Shop Type:"}),e.jsx(j,{className:U(s.type),children:s.type.toUpperCase()})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"Unlimited Stock:"}),e.jsx("span",{className:"font-medium",children:s.unlimited?"Yes":"No"})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"Owner:"}),e.jsx("span",{className:"font-medium truncate",children:s.owner_uuid})]})]})]})]}),s.item_enchants&&Object.keys(s.item_enchants).length>0&&e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold mb-2",children:"Enchantments"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:Object.entries(s.item_enchants).map(([a,t])=>e.jsxs(j,{variant:"outline",children:[a," ",t]},a))})]}),s.item_lore&&s.item_lore.length>0&&e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold mb-2",children:"Lore"}),e.jsx("div",{className:"bg-muted/50 rounded-lg p-4 space-y-2",children:s.item_lore.map((a,t)=>e.jsxs("p",{className:"text-sm italic text-muted-foreground",children:['"',a,'"']},t))})]})]})]})]}),e.jsx("div",{className:"space-y-6",children:e.jsx(ze,{shopName:E(s.item_type,s.item_display_name),coordinates:{x:s.x,y:s.y,z:s.z},world:s.world,className:"w-full"})})]})]})};export{We as default};
